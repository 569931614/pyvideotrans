# BDvideoTrans æ‰“åŒ…é—®é¢˜ä¿®å¤æ€»ç»“

## âœ… æœ€ç»ˆéªŒè¯ç»“æœ

**ç¨‹åºçŠ¶æ€**ï¼šâœ… æˆåŠŸå¯åŠ¨ï¼Œæ— ä»»ä½•é”™è¯¯
- **è¿›ç¨‹ID**: 17276
- **å¯åŠ¨æ—¶é—´**: 2025/10/5 18:35:33
- **å¯æ‰§è¡Œæ–‡ä»¶**: `dist\BDvideoTrans\BDvideoTrans.exe` (46.0 MB)
- **è¿è¡ŒçŠ¶æ€**: æ­£å¸¸è¿è¡Œä¸­ï¼ˆå·²éªŒè¯ï¼‰

**ç›®å½•ç»“æ„éªŒè¯**ï¼š
- âœ… `dist\BDvideoTrans\videotrans\` - é…ç½®æ–‡ä»¶ç›®å½•å·²åˆ›å»º
  - âœ… `cfg.json` (3,848 å­—èŠ‚) - é…ç½®æ–‡ä»¶å·²ç”Ÿæˆ
  - âœ… `params.json` (8,394 å­—èŠ‚) - å‚æ•°æ–‡ä»¶å·²ç”Ÿæˆ
  - âœ… `prompts\` - æç¤ºè¯ç›®å½•å·²åˆ›å»º
- âœ… `dist\BDvideoTrans\_internal\videotrans\language\` - è¯­è¨€æ–‡ä»¶å·²æ‰“åŒ…
  - âœ… `en.json` (31,463 å­—èŠ‚)
  - âœ… `zh.json` (28,680 å­—èŠ‚)
  - âœ… `es.json` (34,074 å­—èŠ‚)
  - âœ… `pt-BR.json` (33,966 å­—èŠ‚)

---

## ğŸ”§ ä¿®å¤çš„é—®é¢˜

### é—®é¢˜ 1ï¼šModuleNotFoundError - _config_loader

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ModuleNotFoundError: No module named 'videotrans.configure._config_loader'
```

**åŸå› **ï¼š
- ä½¿ç”¨æ‡’åŠ è½½æœºåˆ¶ + åŠ¨æ€å¯¼å…¥ï¼ˆ`importlib.import_module`ï¼‰
- PyInstaller æ— æ³•é€šè¿‡é™æ€åˆ†ææ£€æµ‹åŠ¨æ€å¯¼å…¥çš„æ¨¡å—

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
- æ–‡ä»¶ï¼š`videotrans/configure/config.py`
- ä¿®æ”¹ï¼šå°†æ‡’åŠ è½½æ›¿æ¢ä¸ºç›´æ¥å¯¼å…¥
  ```python
  from ._config_loader import *
  ```

---

### é—®é¢˜ 2ï¼šFileNotFoundError - cfg.json

**é”™è¯¯ä¿¡æ¯**ï¼š
```
FileNotFoundError: [Errno 2] No such file or directory: 
'F:/æ™ºèƒ½ä½“å®šåˆ¶/20250904translateVideo/pyvideotrans/dist/BDvideoTrans/videotrans/cfg.json'
```

**åŸå› **ï¼š
- ç¨‹åºå°è¯•åœ¨ `ROOT_DIR/videotrans/` åˆ›å»ºé…ç½®æ–‡ä»¶
- ä½†è¯¥ç›®å½•ä¸å­˜åœ¨

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
- æ–‡ä»¶ï¼š`videotrans/configure/_config_loader.py`
- ä¿®æ”¹ï¼šåœ¨å†™å…¥æ–‡ä»¶å‰å…ˆåˆ›å»ºç›®å½•
  ```python
  Path(ROOT_DIR + "/videotrans").mkdir(parents=True, exist_ok=True)
  ```
- ä¿®æ”¹ä½ç½®ï¼š
  - `parse_init()` å‡½æ•°å¼€å¤´ï¼ˆç¬¬ 199 è¡Œï¼‰
  - `parse_init()` å‡½æ•°ä¸­éƒ¨ï¼ˆç¬¬ 320 è¡Œï¼‰

---

### é—®é¢˜ 3ï¼šFileNotFoundError - language/en.json

**é”™è¯¯ä¿¡æ¯**ï¼š
```
FileNotFoundError: [Errno 2] No such file or directory: 
'F:\\æ™ºèƒ½ä½“å®šåˆ¶\\20250904translateVideo\\pyvideotrans\\dist\\BDvideoTrans\\videotrans\\language\\en.json'
```

**åŸå› **ï¼š
- ç¨‹åºå°è¯•ä» `ROOT_DIR/videotrans/language/` è¯»å–è¯­è¨€æ–‡ä»¶
- ä½†æ‰“åŒ…åçš„æ•°æ®æ–‡ä»¶åœ¨ `_internal/videotrans/language/`ï¼ˆé€šè¿‡ `sys._MEIPASS` è®¿é—®ï¼‰

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
- æ–‡ä»¶ï¼š`videotrans/configure/_config_loader.py`
- ä¿®æ”¹ï¼šåŒºåˆ†å¯å†™ç›®å½•å’Œåªè¯»æ•°æ®ç›®å½•

**1. æ·»åŠ  `DATA_DIR` å˜é‡**ï¼ˆç¬¬ 15-50 è¡Œï¼‰ï¼š
```python
# è·å–æ•°æ®æ–‡ä»¶ç›®å½•ï¼ˆç”¨äºåªè¯»èµ„æºæ–‡ä»¶ï¼Œå¦‚è¯­è¨€æ–‡ä»¶ã€æ ·å¼ç­‰ï¼‰
def _get_data_path():
    if IS_FROZEN:
        # PyInstaller æ‰“åŒ…åï¼Œä½¿ç”¨ sys._MEIPASS è·å–èµ„æºç›®å½•
        if hasattr(sys, '_MEIPASS'):
            return Path(sys._MEIPASS).as_posix()
        else:
            return Path(sys.executable).parent.as_posix()
    else:
        return Path(__file__).parent.parent.parent.as_posix()

# ç¨‹åºæ ¹ç›®å½•ï¼ˆç”¨äºå¯å†™æ–‡ä»¶ï¼‰
ROOT_DIR = _get_executable_path()
_root_path = Path(ROOT_DIR)
# æ•°æ®æ–‡ä»¶ç›®å½•ï¼ˆç”¨äºåªè¯»èµ„æºï¼‰
DATA_DIR = _get_data_path()
_data_path = Path(DATA_DIR)
```

**2. ä¿®æ”¹è¯­è¨€æ–‡ä»¶è¯»å–**ï¼ˆç¬¬ 367-372 è¡Œï¼‰ï¼š
```python
# è¯­è¨€ä»£ç æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆä»æ•°æ®ç›®å½•è¯»å–ï¼‰
_lang_path = _data_path / f'videotrans/language/{defaulelang}.json'
if not _lang_path.exists():
    defaulelang = "en"
    _lang_path = _data_path / f'videotrans/language/{defaulelang}.json'
_obj = json.loads(_lang_path.read_text(encoding='utf-8'))
```

**3. ä¿®æ”¹å…¶ä»–æ•°æ®æ–‡ä»¶è¯»å–**ï¼ˆç¬¬ 653-656 è¡Œï¼‰ï¼š
```python
# gemini è¯­éŸ³è¯†åˆ«æç¤ºè¯ï¼ˆä»æ•°æ®ç›®å½•è¯»å–ï¼‰
_gemini_recogn_txt = 'gemini_recogn.txt' if defaulelang == 'zh' else 'gemini_recogn-en.txt'
if Path(DATA_DIR + f'/videotrans/{_gemini_recogn_txt}').exists():
    params['gemini_srtprompt'] = Path(DATA_DIR + f'/videotrans/{_gemini_recogn_txt}').read_text(encoding='utf-8')
```

---

## ğŸ“Š ç›®å½•ç»“æ„è¯´æ˜

### æ‰“åŒ…åçš„ç›®å½•ç»“æ„

```
dist\BDvideoTrans\
â”œâ”€â”€ BDvideoTrans.exe          # ä¸»ç¨‹åº
â”œâ”€â”€ _internal\                # PyInstaller å†…éƒ¨æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
â”‚   â”œâ”€â”€ videotrans\           # Python æ¨¡å—å’Œæ•°æ®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ language\         # è¯­è¨€æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ en.json
â”‚   â”‚   â”‚   â”œâ”€â”€ zh.json
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ styles\           # æ ·å¼æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
â”‚   â”‚   â”œâ”€â”€ webui\            # Web UI æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
â”‚   â”‚   â””â”€â”€ *.txt             # æç¤ºè¯æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
â”‚   â””â”€â”€ ...
â”œâ”€â”€ videotrans\               # é…ç½®æ–‡ä»¶ç›®å½•ï¼ˆå¯å†™ï¼‰
â”‚   â”œâ”€â”€ cfg.json              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ params.json           # å‚æ•°æ–‡ä»¶
â”‚   â””â”€â”€ prompts\              # ç”¨æˆ·è‡ªå®šä¹‰æç¤ºè¯
â”œâ”€â”€ tmp\                      # ä¸´æ—¶ç›®å½•
â”œâ”€â”€ cache\                    # ç¼“å­˜ç›®å½•
â”œâ”€â”€ logs\                     # æ—¥å¿—ç›®å½•
â””â”€â”€ ...
```

### è·¯å¾„å˜é‡è¯´æ˜

| å˜é‡ | ç”¨é€” | æ‰“åŒ…åçš„å€¼ | ç¤ºä¾‹ |
|------|------|-----------|------|
| `ROOT_DIR` | å¯å†™æ–‡ä»¶ï¼ˆé…ç½®ã€æ—¥å¿—ç­‰ï¼‰ | `sys.executable` çš„çˆ¶ç›®å½• | `F:/dist/BDvideoTrans/` |
| `DATA_DIR` | åªè¯»èµ„æºï¼ˆè¯­è¨€ã€æ ·å¼ç­‰ï¼‰ | `sys._MEIPASS` | `F:/dist/BDvideoTrans/_internal/` |

---

## ğŸ¯ å…³é”®æŠ€æœ¯è¦ç‚¹

### 1. PyInstaller æ‰“åŒ…çš„æ–‡ä»¶åˆ†ç±»

**åªè¯»æ•°æ®æ–‡ä»¶**ï¼ˆä» `DATA_DIR` è¯»å–ï¼‰ï¼š
- è¯­è¨€æ–‡ä»¶ï¼š`videotrans/language/*.json`
- æ ·å¼æ–‡ä»¶ï¼š`videotrans/styles/*`
- Web UI æ–‡ä»¶ï¼š`videotrans/webui/*`
- æç¤ºè¯æ¨¡æ¿ï¼š`videotrans/*.txt`

**å¯å†™é…ç½®æ–‡ä»¶**ï¼ˆä» `ROOT_DIR` è¯»å–/å†™å…¥ï¼‰ï¼š
- é…ç½®æ–‡ä»¶ï¼š`videotrans/cfg.json`
- å‚æ•°æ–‡ä»¶ï¼š`videotrans/params.json`
- ç”¨æˆ·é…ç½®ï¼š`hearsight_config.json`
- æ—¥å¿—æ–‡ä»¶ï¼š`logs/*.log`

### 2. PyInstaller çš„ `sys._MEIPASS`

- PyInstaller æ‰“åŒ…åï¼Œä¼šå°†ç¨‹åºè§£å‹åˆ°ä¸´æ—¶ç›®å½•
- `sys._MEIPASS` æŒ‡å‘è¿™ä¸ªä¸´æ—¶ç›®å½•
- æ‰€æœ‰æ‰“åŒ…çš„æ•°æ®æ–‡ä»¶éƒ½åœ¨è¿™ä¸ªç›®å½•ä¸‹
- ç¨‹åºé€€å‡ºåï¼Œä¸´æ—¶ç›®å½•ä¼šè¢«åˆ é™¤

### 3. é™æ€å¯¼å…¥ vs åŠ¨æ€å¯¼å…¥

| ç±»å‹ | ç¤ºä¾‹ | PyInstaller æ£€æµ‹ |
|------|------|-----------------|
| é™æ€å¯¼å…¥ | `from module import *` | âœ… å¯ä»¥æ£€æµ‹ |
| é™æ€å¯¼å…¥ | `import module` | âœ… å¯ä»¥æ£€æµ‹ |
| åŠ¨æ€å¯¼å…¥ | `importlib.import_module()` | âŒ æ— æ³•æ£€æµ‹ |
| åŠ¨æ€å¯¼å…¥ | `__import__()` | âŒ æ— æ³•æ£€æµ‹ |

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. æ–‡ä»¶è·¯å¾„å¤„ç†

```python
# âœ… æ­£ç¡®ï¼šåŒºåˆ†å¯å†™å’Œåªè¯»ç›®å½•
if IS_FROZEN:
    ROOT_DIR = Path(sys.executable).parent  # å¯å†™
    DATA_DIR = Path(sys._MEIPASS)           # åªè¯»
else:
    ROOT_DIR = DATA_DIR = Path(__file__).parent.parent.parent

# è¯»å–æ•°æ®æ–‡ä»¶
lang_file = DATA_DIR / 'videotrans/language/en.json'

# å†™å…¥é…ç½®æ–‡ä»¶
config_file = ROOT_DIR / 'videotrans/cfg.json'
```

### 2. åˆ›å»ºç›®å½•

```python
# âœ… æ­£ç¡®ï¼šå†™å…¥æ–‡ä»¶å‰å…ˆåˆ›å»ºç›®å½•
Path(ROOT_DIR / "videotrans").mkdir(parents=True, exist_ok=True)
with open(ROOT_DIR / "videotrans/cfg.json", 'w') as f:
    f.write(json.dumps(data))
```

### 3. æ¨¡å—å¯¼å…¥

```python
# âœ… æ­£ç¡®ï¼šä½¿ç”¨é™æ€å¯¼å…¥
from ._config_loader import *

# âŒ é”™è¯¯ï¼šä½¿ç”¨åŠ¨æ€å¯¼å…¥
module = importlib.import_module("._config_loader", __package__)
```

---

## ğŸŠ æ€»ç»“

é€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªä¿®å¤ï¼š
1. âœ… å°†åŠ¨æ€å¯¼å…¥æ”¹ä¸ºé™æ€å¯¼å…¥
2. âœ… åœ¨å†™å…¥æ–‡ä»¶å‰åˆ›å»ºç›®å½•
3. âœ… åŒºåˆ†å¯å†™ç›®å½•å’Œåªè¯»æ•°æ®ç›®å½•

ç¨‹åºç°åœ¨å¯ä»¥æ­£å¸¸æ‰“åŒ…å’Œè¿è¡Œï¼Œæ²¡æœ‰ä»»ä½•é”™è¯¯ï¼

**ä¿®æ”¹æ—¥æœŸ**ï¼š2025-10-05  
**ä¿®æ”¹äºº**ï¼šAI Assistant  
**çŠ¶æ€**ï¼šâœ… å·²éªŒè¯é€šè¿‡ï¼ˆæ‰€æœ‰é—®é¢˜å·²è§£å†³ï¼‰

