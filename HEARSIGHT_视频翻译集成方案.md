# HearSight æ™ºèƒ½æ‘˜è¦ + å‘é‡åº“é›†æˆæ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•å°† HearSight æ™ºèƒ½æ‘˜è¦åŠŸèƒ½é›†æˆåˆ°è§†é¢‘ç¿»è¯‘æµç¨‹ä¸­ï¼Œå¹¶è‡ªåŠ¨å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“ä»¥æ”¯æŒè¯­ä¹‰æ£€ç´¢ã€‚

**æ›´æ–°æ—¥æœŸ**: 2025-10-01
**ç‰ˆæœ¬**: v2.0ï¼ˆè§†é¢‘ç¿»è¯‘é›†æˆç‰ˆï¼‰

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. è‡ªåŠ¨æ‘˜è¦ç”Ÿæˆ

å½“å‹¾é€‰"æ™ºèƒ½æ‘˜è¦"é€‰é¡¹åï¼Œè§†é¢‘ç¿»è¯‘å®Œæˆæ—¶ä¼šè‡ªåŠ¨ï¼š
- âœ… è¯»å–ç”Ÿæˆçš„ SRT å­—å¹•æ–‡ä»¶
- âœ… å°†å­—å¹•åˆå¹¶ä¸ºæ®µè½
- âœ… ç”Ÿæˆæ•´ä½“æ‘˜è¦ï¼ˆä¸»é¢˜ + æ€»ç»“ï¼‰
- âœ… ä¸ºæ¯ä¸ªæ®µè½ç”Ÿæˆç‹¬ç«‹æ‘˜è¦
- âœ… å­˜å‚¨åˆ°æœ¬åœ°å‘é‡æ•°æ®åº“

### 2. å‘é‡æ•°æ®åº“å­˜å‚¨

ä½¿ç”¨ ChromaDB å®ç°ï¼š
- âœ… è¯­ä¹‰æœç´¢ï¼šåŸºäºå†…å®¹ç›¸ä¼¼åº¦æ£€ç´¢
- âœ… æŒä¹…åŒ–å­˜å‚¨ï¼šæ•°æ®ä¿å­˜åœ¨æœ¬åœ° `vector_db/` ç›®å½•
- âœ… å…ƒæ•°æ®æ”¯æŒï¼šå­˜å‚¨è§†é¢‘è·¯å¾„ã€æ—¶é—´æˆ³ã€è¯­è¨€ç­‰ä¿¡æ¯
- âœ… å¢é‡æ›´æ–°ï¼šæ”¯æŒæ·»åŠ ã€æŸ¥è¯¢ã€åˆ é™¤æ“ä½œ

### 3. éé˜»å¡å¤„ç†

- âœ… åå°çº¿ç¨‹å¤„ç†ï¼šä¸å½±å“ä¸»æµç¨‹
- âœ… å®¹é”™æœºåˆ¶ï¼šæ‘˜è¦ç”Ÿæˆå¤±è´¥ä¸å½±å“è§†é¢‘è¾“å‡º
- âœ… æ—¥å¿—è®°å½•ï¼šè¯¦ç»†çš„å¤„ç†æ—¥å¿—ä¾¿äºè°ƒè¯•

---

## ğŸ¯ ä½¿ç”¨æµç¨‹

### æ­¥éª¤ 1ï¼šé…ç½® HearSight

ç‚¹å‡»å·¥å…·æ çš„ **"âš™ï¸"** æŒ‰é’®ï¼Œæ‰“å¼€ HearSight é…ç½®å¯¹è¯æ¡†ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤–  LLM API é…ç½®                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ API Key:    [your-api-key]         â”‚
â”‚ Base URL:   https://api.openai...  â”‚
â”‚ Model:      gpt-3.5-turbo          â”‚
â”‚ Temperature: 0.3                    â”‚
â”‚ Timeout:    120 ç§’                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“  æ®µè½åˆå¹¶å‚æ•°                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœ€å¤§æ—¶é—´é—´éš”: 2.0 ç§’               â”‚
â”‚ æœ€å¤§æ®µè½æ—¶é•¿: 30.0 ç§’              â”‚
â”‚ æœ€å¤§å­—ç¬¦æ•°:   200                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¿…å¡«é¡¹**ï¼š
- âœ… API Key
- âœ… Base URLï¼ˆé»˜è®¤ OpenAIï¼Œä¹Ÿå¯ä½¿ç”¨å…¼å®¹ APIï¼‰
- âœ… Modelï¼ˆæ¨è `gpt-3.5-turbo`ï¼‰

### æ­¥éª¤ 2ï¼šå¯ç”¨æ™ºèƒ½æ‘˜è¦

åœ¨ä¸»ç•Œé¢åº•éƒ¨ï¼Œå‹¾é€‰ **"æ™ºèƒ½æ‘˜è¦"** å¤é€‰æ¡†ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜ Enable CUDA?                     â”‚
â”‚ â˜‘ æ™ºèƒ½æ‘˜è¦                          â”‚ â† å‹¾é€‰è¿™ä¸ª
â”‚                                     â”‚
â”‚  [å¼€å§‹æ‰§è¡Œ]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æç¤º**: é¼ æ ‡æ‚¬åœä¼šæ˜¾ç¤ºï¼š"å®Œæˆç¿»è¯‘åè‡ªåŠ¨ç”Ÿæˆæ™ºèƒ½æ‘˜è¦å¹¶å­˜å‚¨åˆ°å‘é‡åº“"

### æ­¥éª¤ 3ï¼šæ­£å¸¸æ‰§è¡Œè§†é¢‘ç¿»è¯‘

1. é€‰æ‹©è§†é¢‘æ–‡ä»¶
2. é…ç½®ç¿»è¯‘å‚æ•°ï¼ˆæºè¯­è¨€ã€ç›®æ ‡è¯­è¨€ç­‰ï¼‰
3. ç‚¹å‡» **"å¼€å§‹æ‰§è¡Œ"**
4. ç­‰å¾…ç¿»è¯‘å®Œæˆ

### æ­¥éª¤ 4ï¼šè‡ªåŠ¨ç”Ÿæˆæ‘˜è¦

ç¿»è¯‘å®Œæˆåï¼Œç³»ç»Ÿä¼šåœ¨åå°è‡ªåŠ¨ï¼š

```
[100%] è§†é¢‘å¤„ç†å®Œæˆ
   â†“
[åå°] å¯åŠ¨ HearSight å¤„ç†
   â”œâ”€ [10%] è¯»å– SRT å­—å¹•
   â”œâ”€ [30%] åˆå¹¶æ®µè½ï¼ˆè§„åˆ™åŸºç¡€ï¼‰
   â”œâ”€ [60%] ç”Ÿæˆæ•´ä½“æ‘˜è¦
   â”œâ”€ [80%] ç”Ÿæˆæ®µè½æ‘˜è¦
   â””â”€ [100%] å­˜å‚¨åˆ°å‘é‡åº“
```

**æ—¥å¿—ç¤ºä¾‹**ï¼š
```
[INFO] Starting HearSight summary generation for: output/video_zh.srt
[INFO] Merged 15 paragraphs
[INFO] Generated overall summary: Pythonç¼–ç¨‹å…¥é—¨æ•™ç¨‹
[INFO] Generated 15 paragraph summaries
[INFO] âœ… Successfully stored HearSight summary in vector database
```

---

## ğŸ—‚ï¸ å‘é‡æ•°æ®åº“ç»“æ„

### å­˜å‚¨ä½ç½®

```
pyvideotrans/
â”œâ”€â”€ vector_db/           â† ChromaDB æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ chroma.sqlite3
â”‚   â””â”€â”€ ...
```

### æ•°æ®ç»“æ„

æ¯ä¸ªè§†é¢‘å­˜å‚¨çš„æ•°æ®åŒ…æ‹¬ï¼š

#### 1. æ•´ä½“æ‘˜è¦ï¼ˆ1æ¡ï¼‰
```python
{
    "id": "video_id_overall",
    "document": "ä¸»é¢˜: Pythonç¼–ç¨‹\næ€»ç»“: æœ¬è§†é¢‘ä»‹ç»äº†...",
    "metadata": {
        "video_id": "md5_hash",
        "video_path": "/path/to/video.mp4",
        "type": "overall_summary",
        "topic": "Pythonç¼–ç¨‹",
        "paragraph_count": 15,
        "total_duration": 600.5,
        "basename": "video",
        "source_language": "en",
        "target_language": "zh"
    }
}
```

#### 2. æ®µè½æ•°æ®ï¼ˆNæ¡ï¼‰
```python
{
    "id": "video_id_para_0",
    "document": "æ®µè½æ‘˜è¦: ä»‹ç»Pythonçš„åŸºæœ¬è¯­æ³•\nå®Œæ•´å†…å®¹: å¤§å®¶å¥½...",
    "metadata": {
        "video_id": "md5_hash",
        "video_path": "/path/to/video.mp4",
        "type": "paragraph",
        "index": 0,
        "start_time": 0.0,
        "end_time": 30.5,
        "has_summary": true,
        "paragraph_summary": "ä»‹ç»Pythonçš„åŸºæœ¬è¯­æ³•"
    }
}
```

---

## ğŸ” è¯­ä¹‰æ£€ç´¢ç¤ºä¾‹

### Python API ä½¿ç”¨

```python
from videotrans.hearsight.vector_store import get_vector_store

# è·å–å‘é‡åº“å®ä¾‹
vector_store = get_vector_store()

# 1. è¯­ä¹‰æœç´¢ï¼ˆå…¨åº“ï¼‰
results = vector_store.search(
    query="å¦‚ä½•å®šä¹‰å‡½æ•°ï¼Ÿ",
    n_results=5
)

for result in results:
    print(f"åŒ¹é…åº¦: {result['distance']:.3f}")
    print(f"è§†é¢‘: {result['metadata']['video_path']}")
    print(f"å†…å®¹: {result['document'][:100]}...")
    print("-" * 50)

# 2. åœ¨ç‰¹å®šè§†é¢‘ä¸­æœç´¢
video_id = vector_store._generate_video_id("/path/to/video.mp4")
results = vector_store.search(
    query="å˜é‡èµ‹å€¼",
    n_results=3,
    video_id=video_id
)

# 3. åªæœç´¢æ®µè½ï¼ˆä¸åŒ…å«æ•´ä½“æ‘˜è¦ï¼‰
results = vector_store.search(
    query="åˆ—è¡¨æ“ä½œ",
    n_results=5,
    filter_type="paragraph"
)

# 4. è·å–è§†é¢‘çš„å®Œæ•´æ‘˜è¦
summary_data = vector_store.get_video_summary("/path/to/video.mp4")
print(f"ä¸»é¢˜: {summary_data['overall']['metadata']['topic']}")
print(f"æ®µè½æ•°: {len(summary_data['paragraphs'])}")

# 5. åˆ—å‡ºæ‰€æœ‰è§†é¢‘
videos = vector_store.list_all_videos()
for video in videos:
    print(f"{video['topic']} ({video['paragraph_count']}æ®µ)")

# 6. åˆ é™¤è§†é¢‘æ•°æ®
vector_store.delete_video("/path/to/video.mp4")
```

### æœç´¢ç»“æœç¤ºä¾‹

```python
# æŸ¥è¯¢: "å¦‚ä½•å®šä¹‰å‡½æ•°ï¼Ÿ"
[
    {
        "document": "æ®µè½æ‘˜è¦: ä»‹ç»å‡½æ•°å®šä¹‰çš„åŸºæœ¬è¯­æ³•\nå®Œæ•´å†…å®¹: åœ¨Pythonä¸­ï¼Œä½¿ç”¨defå…³é”®å­—å®šä¹‰å‡½æ•°...",
        "metadata": {
            "video_path": "/videos/python_tutorial.mp4",
            "start_time": 120.5,
            "end_time": 150.2,
            "paragraph_summary": "ä»‹ç»å‡½æ•°å®šä¹‰çš„åŸºæœ¬è¯­æ³•"
        },
        "distance": 0.15  # ç›¸ä¼¼åº¦é«˜
    },
    {
        "document": "æ®µè½æ‘˜è¦: æ¼”ç¤ºå‡½æ•°å‚æ•°çš„ä½¿ç”¨æ–¹æ³•\nå®Œæ•´å†…å®¹: å‡½æ•°å¯ä»¥æ¥å—å‚æ•°ï¼Œä¾‹å¦‚...",
        "metadata": {
            "video_path": "/videos/python_advanced.mp4",
            "start_time": 45.0,
            "end_time": 75.8
        },
        "distance": 0.28
    }
]
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### HearSight é…ç½®é¡¹

#### LLM API é…ç½®
| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `api_key` | **å¿…å¡«** | OpenAI å…¼å®¹ API å¯†é’¥ |
| `base_url` | `https://api.openai.com/v1` | API åŸºç¡€ URL |
| `model` | `gpt-3.5-turbo` | æ¨¡å‹åç§° |
| `temperature` | `0.3` | æ¸©åº¦å‚æ•°ï¼ˆ0.0-2.0ï¼‰ |
| `timeout` | `120` | è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ |

#### æ®µè½åˆå¹¶é…ç½®
| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `max_gap` | `2.0` | æœ€å¤§æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰ |
| `max_duration` | `30.0` | æœ€å¤§æ®µè½æ—¶é•¿ï¼ˆç§’ï¼‰ |
| `max_chars` | `200` | æœ€å¤§å­—ç¬¦æ•° |

### å‘é‡åº“é…ç½®

å‘é‡åº“ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå­˜å‚¨åœ¨ `pyvideotrans/vector_db/` ç›®å½•ã€‚

å¦‚éœ€è‡ªå®šä¹‰ï¼Œå¯ä¿®æ”¹ `vector_store.py`:
```python
# è‡ªå®šä¹‰æŒä¹…åŒ–ç›®å½•
vector_store = VectorStore(persist_directory="/custom/path")
```

---

## ğŸ’¡ å·¥ä½œåŸç†

### å¤„ç†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 è§†é¢‘ç¿»è¯‘ä¸»æµç¨‹                          â”‚
â”‚  1. æå–éŸ³é¢‘                                            â”‚
â”‚  2. è¯­éŸ³è¯†åˆ«ï¼ˆç”Ÿæˆ SRTï¼‰                                â”‚
â”‚  3. ç¿»è¯‘å­—å¹•                                            â”‚
â”‚  4. é…éŸ³ç”Ÿæˆ                                            â”‚
â”‚  5. è§†é¢‘åˆæˆ                                            â”‚
â”‚  âœ… ç¿»è¯‘å®Œæˆ                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”œâ”€â†’ [if enable_hearsight = true]
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    HearSight åå°å¤„ç†çº¿ç¨‹           â”‚
         â”‚  (éé˜»å¡ï¼Œä¸å½±å“ä¸»æµç¨‹)             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Step 1: è¯»å– SRT æ–‡ä»¶      â”‚
    â”‚  - ä¼˜å…ˆç›®æ ‡è¯­è¨€å­—å¹•          â”‚
    â”‚  - å›é€€åˆ°æºè¯­è¨€å­—å¹•          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Step 2: åˆå¹¶æ®µè½           â”‚
    â”‚  - åŸºäºæ—¶é—´é—´éš”              â”‚
    â”‚  - åŸºäºå­—ç¬¦é™åˆ¶              â”‚
    â”‚  - åŸºäºæ ‡ç‚¹ç¬¦å·              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Step 3: ç”Ÿæˆæ•´ä½“æ‘˜è¦       â”‚
    â”‚  - LLM API è°ƒç”¨ï¼ˆ1æ¬¡ï¼‰      â”‚
    â”‚  - æå–ä¸»é¢˜ + æ€»ç»“           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Step 4: ç”Ÿæˆæ®µè½æ‘˜è¦       â”‚
    â”‚  - LLM API è°ƒç”¨ï¼ˆNæ¬¡ï¼‰      â”‚
    â”‚  - æ¯æ®µä¸è¶…è¿‡50å­—            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Step 5: å­˜å‚¨å‘é‡åº“         â”‚
    â”‚  - 1æ¡æ•´ä½“æ‘˜è¦              â”‚
    â”‚  - Næ¡æ®µè½æ•°æ®              â”‚
    â”‚  - è¯­ä¹‰å‘é‡åµŒå…¥              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  âœ… å®Œæˆ
```

### ä»£ç é›†æˆç‚¹

#### 1. UI å±‚ï¼ˆ`videotrans/ui/en.py`ï¼‰
```python
# æ·»åŠ æ™ºèƒ½æ‘˜è¦å¤é€‰æ¡†
self.enable_hearsight = QtWidgets.QCheckBox(self.layoutWidget)
self.enable_hearsight.setToolTip("å®Œæˆç¿»è¯‘åè‡ªåŠ¨ç”Ÿæˆæ™ºèƒ½æ‘˜è¦å¹¶å­˜å‚¨åˆ°å‘é‡åº“")
```

#### 2. ä¸»çª—å£ï¼ˆ`videotrans/mainwin/_main_win.py`ï¼‰
```python
# è®¾ç½®æ–‡æœ¬å’ŒçŠ¶æ€
self.enable_hearsight.setText('æ™ºèƒ½æ‘˜è¦')
self.enable_hearsight.setChecked(bool(config.params.get('enable_hearsight', False)))
```

#### 3. ä»»åŠ¡å®Œæˆå›è°ƒï¼ˆ`videotrans/task/trans_create.py`ï¼‰
```python
def task_done(self):
    # ... ç°æœ‰é€»è¾‘ ...

    # å¯åŠ¨ HearSight åå°å¤„ç†
    def _hearsight_local():
        if not config.params.get('enable_hearsight', False):
            return

        # 1. è¯»å–é…ç½®
        # 2. æŸ¥æ‰¾ SRT æ–‡ä»¶
        # 3. ç”Ÿæˆæ‘˜è¦
        # 4. å­˜å‚¨å‘é‡åº“

    threading.Thread(target=_hearsight_local, daemon=True).start()
```

#### 4. å‘é‡å­˜å‚¨ï¼ˆ`videotrans/hearsight/vector_store.py`ï¼‰
```python
class VectorStore:
    def store_summary(self, video_path, summary, paragraphs, metadata):
        # 1. å­˜å‚¨æ•´ä½“æ‘˜è¦
        # 2. å­˜å‚¨æ¯ä¸ªæ®µè½
        # 3. è‡ªåŠ¨ç”Ÿæˆå‘é‡åµŒå…¥

    def search(self, query, n_results=5):
        # è¯­ä¹‰æœç´¢
        return results
```

---

## ğŸš€ æ€§èƒ½ä¸æˆæœ¬

### å¤„ç†æ—¶é—´

ä»¥ 10åˆ†é’Ÿè§†é¢‘ï¼ˆ15ä¸ªæ®µè½ï¼‰ä¸ºä¾‹ï¼š

| æ­¥éª¤ | è€—æ—¶ | è¯´æ˜ |
|------|------|------|
| è¯»å– SRT | <1ç§’ | IO æ“ä½œ |
| åˆå¹¶æ®µè½ | <5ç§’ | æœ¬åœ°è®¡ç®— |
| æ•´ä½“æ‘˜è¦ | 10-30ç§’ | LLM API è°ƒç”¨ |
| æ®µè½æ‘˜è¦ | 15-45ç§’ | 15æ¬¡ LLM è°ƒç”¨ |
| å­˜å‚¨å‘é‡åº“ | 2-5ç§’ | æœ¬åœ°å†™å…¥ + åµŒå…¥ |
| **æ€»è®¡** | **30-90ç§’** | åå°å¤„ç†ï¼Œä¸é˜»å¡ |

### API æˆæœ¬

ä½¿ç”¨ `gpt-3.5-turbo` è®¡è´¹ï¼ˆä»¥10åˆ†é’Ÿè§†é¢‘ä¸ºä¾‹ï¼‰ï¼š

| é¡¹ç›® | Tokens | æˆæœ¬ (USD) |
|------|--------|-----------|
| æ•´ä½“æ‘˜è¦ï¼ˆè¾“å…¥ï¼‰ | ~800 | $0.0008 |
| æ•´ä½“æ‘˜è¦ï¼ˆè¾“å‡ºï¼‰ | ~200 | $0.0003 |
| æ®µè½æ‘˜è¦ï¼ˆè¾“å…¥ï¼‰| ~2250 (15Ã—150) | $0.00225 |
| æ®µè½æ‘˜è¦ï¼ˆè¾“å‡ºï¼‰| ~750 (15Ã—50) | $0.0011 |
| **æ€»è®¡** | ~4000 | **$0.0045** |

**çº¦ 3 åˆ†é’±äººæ°‘å¸** per 10-minute video

### ä¼˜åŒ–å»ºè®®

#### é™ä½æˆæœ¬
1. ä½¿ç”¨å›½äº§æ¨¡å‹ï¼ˆDeepSeekã€Qwen ç­‰ï¼‰
2. å‡å°‘æ®µè½æ•°é‡ï¼ˆå¢å¤§ `max_duration`ï¼‰
3. ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹

#### æé«˜é€Ÿåº¦
1. å¢åŠ  API timeout
2. ä½¿ç”¨æ›´å¿«çš„ API æœåŠ¡å•†
3. è€ƒè™‘æœ¬åœ° LLMï¼ˆOllamaï¼‰

#### æå‡è´¨é‡
1. ä½¿ç”¨ `gpt-4` æˆ– `claude-3-sonnet`
2. è°ƒæ•´ temperatureï¼ˆ0.3-0.5ï¼‰
3. ä¼˜åŒ–æç¤ºè¯

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æ‘˜è¦æœªç”Ÿæˆ

**ç—‡çŠ¶**: ç¿»è¯‘å®Œæˆï¼Œä½†æ²¡æœ‰çœ‹åˆ°æ‘˜è¦ç”Ÿæˆæ—¥å¿—

**æ£€æŸ¥æ¸…å•**:
- âœ… æ˜¯å¦å‹¾é€‰äº†"æ™ºèƒ½æ‘˜è¦"å¤é€‰æ¡†ï¼Ÿ
- âœ… HearSight é…ç½®æ˜¯å¦å®Œæ•´ï¼ˆAPI Key ç­‰ï¼‰ï¼Ÿ
- âœ… æ˜¯å¦æœ‰ SRT å­—å¹•æ–‡ä»¶ç”Ÿæˆï¼Ÿ
- âœ… æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

**è§£å†³æ–¹æ¡ˆ**:
```python
# æŸ¥çœ‹æ—¥å¿—
import logging
logging.basicConfig(level=logging.INFO)

# æ‰‹åŠ¨æµ‹è¯•
from videotrans.hearsight.vector_store import get_vector_store
vector_store = get_vector_store()
videos = vector_store.list_all_videos()
print(f"å·²å­˜å‚¨è§†é¢‘æ•°: {len(videos)}")
```

### é—®é¢˜ 2: ChromaDB æœªå®‰è£…

**ç—‡çŠ¶**: æŠ¥é”™ `ModuleNotFoundError: No module named 'chromadb'`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å®‰è£… ChromaDB
pip install chromadb

# éªŒè¯å®‰è£…
python -c "import chromadb; print(chromadb.__version__)"
```

### é—®é¢˜ 3: API è°ƒç”¨å¤±è´¥

**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º "HearSight local summary error"

**å¯èƒ½åŸå› **:
1. API Key æ— æ•ˆ
2. ç½‘ç»œè¿æ¥é—®é¢˜
3. API é…é¢è€—å°½
4. Base URL é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```python
# æµ‹è¯• API è¿æ¥
from videotrans.hearsight.chat_client import chat_simple

response = chat_simple(
    prompt="ä½ å¥½",
    api_key="your-api-key",
    base_url="https://api.openai.com/v1",
    model="gpt-3.5-turbo"
)
print(response)  # åº”è¯¥è¿”å›é—®å€™è¯­
```

### é—®é¢˜ 4: å‘é‡åº“å ç”¨ç©ºé—´è¿‡å¤§

**ç—‡çŠ¶**: `vector_db/` ç›®å½•å ç”¨ç£ç›˜ç©ºé—´è¾ƒå¤§

**è§£å†³æ–¹æ¡ˆ**:
```python
# æ¸…ç†ä¸éœ€è¦çš„è§†é¢‘æ•°æ®
from videotrans.hearsight.vector_store import get_vector_store

vector_store = get_vector_store()

# åˆ—å‡ºæ‰€æœ‰è§†é¢‘
videos = vector_store.list_all_videos()
for video in videos:
    print(f"{video['video_path']} - {video['topic']}")

# åˆ é™¤ç‰¹å®šè§†é¢‘
vector_store.delete_video("/path/to/old/video.mp4")
```

---

## ğŸ“Š ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: è§†é¢‘å†…å®¹æ£€ç´¢

**éœ€æ±‚**: åœ¨å¤§é‡ç¿»è¯‘è¿‡çš„è§†é¢‘ä¸­å¿«é€Ÿæ‰¾åˆ°ç›¸å…³å†…å®¹

```python
from videotrans.hearsight.vector_store import get_vector_store

vector_store = get_vector_store()

# æœç´¢: "å¦‚ä½•ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼"
results = vector_store.search(
    query="åˆ—è¡¨æ¨å¯¼å¼ç”¨æ³•ç¤ºä¾‹",
    n_results=10
)

for r in results:
    meta = r['metadata']
    print(f"è§†é¢‘: {meta['basename']}")
    print(f"æ—¶é—´: {meta['start_time']:.1f}s - {meta['end_time']:.1f}s")
    print(f"å†…å®¹: {r['document'][:100]}...")
    print("-" * 60)
```

### åœºæ™¯ 2: è§†é¢‘å†…å®¹åˆ†æ

**éœ€æ±‚**: åˆ†æè§†é¢‘çš„ä¸»é¢˜å’Œç»“æ„

```python
from videotrans.hearsight.vector_store import get_vector_store

vector_store = get_vector_store()

# è·å–å®Œæ•´æ‘˜è¦
summary_data = vector_store.get_video_summary("/path/to/video.mp4")

# åˆ†æ
print(f"ä¸»é¢˜: {summary_data['overall']['metadata']['topic']}")
print(f"æ€»æ—¶é•¿: {summary_data['overall']['metadata']['total_duration']}ç§’")
print(f"\næ®µè½ç»“æ„:")

for i, para in enumerate(summary_data['paragraphs'], 1):
    meta = para['metadata']
    duration = meta['end_time'] - meta['start_time']
    summary = meta.get('paragraph_summary', 'æ— ')
    print(f"  {i}. [{duration:.1f}s] {summary}")
```

### åœºæ™¯ 3: æ‰¹é‡å¤„ç†å†å²è§†é¢‘

**éœ€æ±‚**: ä¸ºä¹‹å‰ç¿»è¯‘çš„è§†é¢‘è¡¥å……ç”Ÿæˆæ‘˜è¦

```python
import os
from pathlib import Path
from videotrans.hearsight.segment_merger import merge_srt_to_paragraphs
from videotrans.hearsight.summarizer import generate_summary, generate_paragraph_summaries
from videotrans.hearsight.vector_store import get_vector_store

# é…ç½®
llm_cfg = {
    'api_key': 'your-api-key',
    'base_url': 'https://api.openai.com/v1',
    'model': 'gpt-3.5-turbo'
}

vector_store = get_vector_store()

# æŸ¥æ‰¾æ‰€æœ‰ SRT æ–‡ä»¶
srt_dir = Path("/path/to/output/dir")
for srt_file in srt_dir.rglob("*.srt"):
    print(f"å¤„ç†: {srt_file}")

    try:
        # 1. åˆå¹¶æ®µè½
        paragraphs = merge_srt_to_paragraphs(str(srt_file))

        # 2. ç”Ÿæˆæ‘˜è¦
        summary = generate_summary(paragraphs, **llm_cfg)
        paragraphs_with_summaries = generate_paragraph_summaries(paragraphs, **llm_cfg)

        # 3. å­˜å‚¨
        video_path = str(srt_file.with_suffix('.mp4'))
        vector_store.store_summary(video_path, summary, paragraphs_with_summaries)

        print(f"  âœ… å®Œæˆ")
    except Exception as e:
        print(f"  âŒ å¤±è´¥: {e}")
```

---

## ğŸ“š API å‚è€ƒ

### VectorStore ç±»

#### `__init__(persist_directory=None)`
åˆå§‹åŒ–å‘é‡å­˜å‚¨

**å‚æ•°**:
- `persist_directory` (str, optional): æŒä¹…åŒ–ç›®å½•è·¯å¾„

#### `initialize() -> bool`
åˆå§‹åŒ– ChromaDB å®¢æˆ·ç«¯

**è¿”å›**: åˆå§‹åŒ–æ˜¯å¦æˆåŠŸ

#### `store_summary(video_path, summary, paragraphs, metadata=None) -> bool`
å­˜å‚¨è§†é¢‘æ‘˜è¦

**å‚æ•°**:
- `video_path` (str): è§†é¢‘æ–‡ä»¶è·¯å¾„
- `summary` (dict): æ•´ä½“æ‘˜è¦
- `paragraphs` (list): æ®µè½åˆ—è¡¨
- `metadata` (dict, optional): é¢å¤–å…ƒæ•°æ®

**è¿”å›**: æ˜¯å¦å­˜å‚¨æˆåŠŸ

#### `search(query, n_results=5, video_id=None, filter_type=None) -> List[Dict]`
è¯­ä¹‰æœç´¢

**å‚æ•°**:
- `query` (str): æŸ¥è¯¢æ–‡æœ¬
- `n_results` (int): è¿”å›ç»“æœæ•°é‡
- `video_id` (str, optional): é™åˆ¶åœ¨ç‰¹å®šè§†é¢‘
- `filter_type` (str, optional): è¿‡æ»¤ç±»å‹

**è¿”å›**: æœç´¢ç»“æœåˆ—è¡¨

#### `delete_video(video_path) -> bool`
åˆ é™¤è§†é¢‘æ•°æ®

**å‚æ•°**:
- `video_path` (str): è§†é¢‘è·¯å¾„

**è¿”å›**: æ˜¯å¦åˆ é™¤æˆåŠŸ

#### `get_video_summary(video_path) -> Optional[Dict]`
è·å–è§†é¢‘å®Œæ•´æ‘˜è¦

**å‚æ•°**:
- `video_path` (str): è§†é¢‘è·¯å¾„

**è¿”å›**: æ‘˜è¦æ•°æ®æˆ– None

#### `list_all_videos() -> List[Dict]`
åˆ—å‡ºæ‰€æœ‰è§†é¢‘

**è¿”å›**: è§†é¢‘åˆ—è¡¨

---

## ğŸ¯ æ€»ç»“

### å·²å®ç°åŠŸèƒ½

âœ… **UI é›†æˆ**
- ä¸»ç•Œé¢æ·»åŠ "æ™ºèƒ½æ‘˜è¦"å¤é€‰æ¡†
- HearSight é…ç½®å¯¹è¯æ¡†

âœ… **æ ¸å¿ƒåŠŸèƒ½**
- è§†é¢‘ç¿»è¯‘å®Œæˆåè‡ªåŠ¨ç”Ÿæˆæ‘˜è¦
- æ•´ä½“æ‘˜è¦ + æ®µè½çº§æ‘˜è¦
- éé˜»å¡åå°å¤„ç†

âœ… **å‘é‡æ•°æ®åº“**
- ChromaDB å­˜å‚¨
- è¯­ä¹‰æœç´¢
- æŒä¹…åŒ– + å…ƒæ•°æ®

âœ… **å®¹é”™æœºåˆ¶**
- API è°ƒç”¨å¤±è´¥å¤„ç†
- æ—¥å¿—è®°å½•
- ä¸å½±å“ä¸»æµç¨‹

### ä½¿ç”¨ä¼˜åŠ¿

1. **è‡ªåŠ¨åŒ–**: æ— éœ€æ‰‹åŠ¨æ“ä½œï¼Œå‹¾é€‰å³å¯
2. **é«˜æ•ˆ**: åå°å¤„ç†ï¼Œä¸å½±å“ä¸»æµç¨‹
3. **æ™ºèƒ½**: åŸºäº LLM çš„é«˜è´¨é‡æ‘˜è¦
4. **å¯æ£€ç´¢**: å‘é‡åº“æ”¯æŒè¯­ä¹‰æœç´¢
5. **ä½æˆæœ¬**: æ¯ä¸ª10åˆ†é’Ÿè§†é¢‘çº¦3åˆ†é’±

### ä¸‹ä¸€æ­¥ä¼˜åŒ–

å¯èƒ½çš„æ”¹è¿›æ–¹å‘ï¼š
1. **å¹¶å‘å¤„ç†**: ä½¿ç”¨çº¿ç¨‹æ± åŠ é€Ÿæ®µè½æ‘˜è¦ç”Ÿæˆ
2. **ç¼“å­˜æœºåˆ¶**: é¿å…é‡å¤å†…å®¹çš„é‡å¤è°ƒç”¨
3. **Web UI**: æä¾›å‘é‡åº“ç®¡ç†ç•Œé¢
4. **å¤šæ¨¡æ€**: æ”¯æŒè§†é¢‘å¸§åˆ†æ
5. **å¯¼å‡ºåŠŸèƒ½**: å¯¼å‡ºæ‘˜è¦ä¸º PDF/HTML

---

**å¼€å‘å®Œæˆæ—¶é—´**: 2025-10-01
**ç‰ˆæœ¬**: v2.0ï¼ˆè§†é¢‘ç¿»è¯‘é›†æˆç‰ˆï¼‰
