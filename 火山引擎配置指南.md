# 火山引擎向量化服务配置指南

## 问题诊断

如果您遇到以下错误：
```
InvalidEndpointOrModel.NotFound
The model or endpoint does not exist or you do not have access to it
```

这表示配置的 Embedding Model (endpoint ID) 无效。

## 解决步骤

### 1. 登录火山引擎控制台

访问: https://console.volcengine.com/ark

### 2. 创建或查找 Embedding 模型端点

1. 进入"推理接入点"页面:
   https://console.volcengine.com/ark/region:ark+cn-beijing/endpoint

2. 点击"创建接入点"或查看已有接入点

3. 推荐的 Embedding 模型：
   - **bge-large-zh** (中文向量化，推荐)
   - bge-m3
   - text-embedding-ada-002 (兼容OpenAI)

4. 创建接入点后，记录 **Endpoint ID**
   - 格式: `ep-xxxxxxxxxxxxxx-xxxxx`
   - 例如: `ep-20250110123456-abcde`

### 3. 获取 API Key

1. 访问 API Key 管理页面:
   https://console.volcengine.com/ark/region:ark+cn-beijing/apiKey

2. 创建新的 API Key 或使用已有的

3. **重要**: 请妥善保管您的 API Key

### 4. 更新配置文件

编辑 `pyvideotrans/hearsight_config.json`:

```json
{
  "database": {
    "host": "117.72.164.82",
    "port": 5433,
    "user": "admin",
    "password": "Admin@123",
    "database": "hearsight"
  },
  "vector": {
    "type": "volcengine",
    "persist_directory": null,
    "volcengine": {
      "api_key": "您的API密钥",
      "base_url": "https://ark.cn-beijing.volces.com/api/v3",
      "collection_name": "video_summaries",
      "embedding_model": "您的Endpoint ID"
    },
    "postgresql": {
      "use_shared_db": true
    }
  },
  "ai": {
    "provider": "openai",
    "api_key": "",
    "base_url": "https://api.siliconflow.cn/v1",
    "model": "deepseek-ai/DeepSeek-V3"
  }
}
```

**关键配置项**:
- `vector.type`: 改为 `"volcengine"`
- `vector.volcengine.api_key`: 填入您的 API Key
- `vector.volcengine.embedding_model`: 填入有效的 Endpoint ID

### 5. 测试连接

运行测试脚本验证配置:
```bash
cd pyvideotrans
python test_volcengine_vector.py
```

如果配置正确，您会看到:
```
[OK] 连接测试成功！
[OK] 向量化成功！
```

## 常见问题

### Q1: 404 错误 - Endpoint Not Found
**原因**: Endpoint ID 无效或已被删除
**解决**: 在控制台创建新的 Embedding 端点，并更新配置

### Q2: 401/403 错误 - 认证失败
**原因**: API Key 无效或过期
**解决**: 重新生成 API Key 并更新配置

### Q3: 429 错误 - 请求过多
**原因**: 超过 API 调用限制
**解决**:
- 检查账户余额
- 等待一段时间后重试
- 联系火山引擎客服提升配额

### Q4: 500 错误 - 服务器错误
**原因**: 火山引擎服务暂时不可用
**解决**: 稍后重试，或切换到其他向量后端(PostgreSQL/ChromaDB)

## 切换向量后端

如果您暂时无法使用火山引擎，可以切换到其他后端：

### 使用 PostgreSQL (已配置)
```json
{
  "vector": {
    "type": "postgresql",
    ...
  }
}
```

### 使用 ChromaDB (本地)
```json
{
  "vector": {
    "type": "chromadb",
    "persist_directory": "F:\\智能体定制\\20250904translateVideo\\pyvideotrans\\vector_db"
  }
}
```

## 成本说明

火山引擎 Embedding API 是按调用次数计费的：
- 文本向量化: 每1000次调用约 ¥0.1-0.5 (根据模型不同)
- 建议先充值小额进行测试

## 技术支持

- 火山引擎文档: https://www.volcengine.com/docs/82379
- API 参考: https://www.volcengine.com/docs/82379/1521766
- 工单支持: https://console.volcengine.com/workorder
