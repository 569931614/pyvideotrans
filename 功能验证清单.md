# 功能验证清单

最后更新: 2025-10-11

## 🎯 验证目标

确保所有新增功能正常工作，特别是：
1. 视频预处理功能
2. 火山引擎向量化服务
3. 配置界面访问

## ✅ 验证步骤

### 第一步：启动程序

```bash
# 1. 进入项目目录
cd F:\智能体定制\20250904translateVideo\pyvideotrans

# 2. 激活虚拟环境（重要！）
venv\Scripts\activate  # Windows
# 或
source venv/bin/activate  # Linux/Mac

# 3. 启动程序
python sp.py
```

**预期结果**:
- ✅ 程序正常启动
- ✅ 显示HTML UI界面
- ✅ 没有错误提示

### 第二步：验证视频预处理UI

#### HTML UI界面

在"输入与输出"部分检查：

```
预期显示:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📁 输入与输出
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
☑️ 智能摘要 [⚙️]
☑️ 视频预处理
   去掉头部(秒) [0.0]  去掉尾部(秒) [0.0]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**验证项**:
- [ ] "视频预处理"复选框存在
- [ ] "去掉头部(秒)"输入框存在
- [ ] "去掉尾部(秒)"输入框存在
- [ ] 输入框可以输入数字
- [ ] 支持小数（如2.5）

#### Qt原生UI界面

如果使用Qt UI，在主界面上方区域检查相同的控件。

### 第三步：验证配置按钮

#### HTML UI

1. 找到"智能摘要"选项
2. 查看其右侧是否有 ⚙️ 按钮

```
预期显示:
☑️ 智能摘要 [⚙️]  ← 这里应该有齿轮按钮
```

**验证项**:
- [ ] ⚙️ 配置按钮显示
- [ ] 鼠标悬停显示提示"智能摘要与向量化配置"
- [ ] 按钮可点击

#### Qt UI

在左侧垂直侧边栏检查：

```
预期显示:
┌──────┐
│  🎬  │ HearSight查看器
│  ⚙️  │ 智能摘要配置 ← 这个
│  📚  │ 摘要管理器
│  ⚙️  │ 系统设置
│  ℹ️  │ 关于
└──────┘
```

**验证项**:
- [ ] 侧边栏显示
- [ ] 配置图标存在
- [ ] 可以点击

### 第四步：打开配置对话框

#### 操作步骤

1. 点击 ⚙️ 配置按钮
2. 等待对话框打开

**预期结果**:
```
应该弹出对话框，标题:
⚙️ 智能摘要配置中心
```

**验证项**:
- [ ] 对话框成功打开
- [ ] 没有错误提示
- [ ] 没有"无法打开配置"错误

#### 如果失败

打开浏览器开发者工具（F12）：
1. 切换到 **Console** 标签
2. 点击配置按钮
3. 查看错误信息
4. 将错误信息记录下来

### 第五步：验证配置对话框内容

对话框应该包含以下部分：

#### 1. LLM API 配置

```
🤖 LLM API 配置
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔑 API Key *: [输入框，密码模式]
🌐 Base URL *: [输入框，显示URL]
🤖 Model *: [下拉选择框]
🌡️ Temperature: [数值输入框]
⏱️ 超时时间: [数值输入框 + "秒"]
```

**验证项**:
- [ ] 所有输入框正常显示
- [ ] API Key显示为密码（****）
- [ ] Model下拉框可以选择
- [ ] 数值输入框可以输入

#### 2. 段落合并参数

```
📐 段落合并参数
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⏳ 最大时间间隔: [2.0 秒]
⏱️ 最大段落时长: [30.0 秒]
📝 最大字符数: [200]
```

**验证项**:
- [ ] 所有参数正常显示
- [ ] 可以修改数值
- [ ] 有合理的范围限制

#### 3. 向量化服务配置 ⭐

```
🗄️ 向量化服务配置
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📦 向量存储类型: [下拉框]
   选项:
   - ChromaDB (本地)
   - 火山引擎向量化服务 ⭐
```

**验证项**:
- [ ] 下拉框正常显示
- [ ] 可以切换选项
- [ ] 默认选择ChromaDB

#### 4. 火山引擎配置（条件显示）

选择"火山引擎向量化服务"后：

```
应该显示:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔑 API Key: [输入框]
🌐 Base URL: [输入框，有默认值]
📚 Collection名称: [输入框，有默认值]
🤖 Embedding模型: [输入框]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**验证项**:
- [ ] 选择火山引擎后这些输入框出现
- [ ] 选择ChromaDB后这些输入框隐藏
- [ ] Base URL有默认值：https://ark.cn-beijing.volces.com/api/v3
- [ ] Collection名称有默认值：video_summaries

### 第六步：测试配置功能

#### 测试1: 填写LLM配置

1. 填写 API Key（任意测试值）
2. 选择一个 Model
3. 点击 "🔌 测试连接" 按钮

**验证项**:
- [ ] 按钮可以点击
- [ ] 显示"测试中..."状态
- [ ] 返回测试结果（成功或失败）

#### 测试2: 切换向量存储类型

1. 在下拉框选择"火山引擎向量化服务"
2. 观察界面变化

**验证项**:
- [ ] 火山引擎配置项出现
- [ ] 所有输入框正常显示

3. 切换回"ChromaDB (本地)"

**验证项**:
- [ ] 火山引擎配置项隐藏

#### 测试3: 保存配置

1. 填写完整的配置信息
2. 点击 "💾 保存配置" 按钮

**验证项**:
- [ ] 显示"配置已保存"提示
- [ ] 对话框关闭或保持打开
- [ ] 没有错误信息

#### 测试4: 配置持久化

1. 保存配置后关闭程序
2. 重新启动程序
3. 再次打开配置对话框

**验证项**:
- [ ] 配置值被正确恢复
- [ ] 向量存储类型正确
- [ ] LLM配置正确

### 第七步：测试视频预处理功能

#### 准备测试视频

准备一个短视频文件（如30秒）

#### 操作步骤

1. 勾选"视频预处理"
2. 设置去掉头部：5.0 秒
3. 设置去掉尾部：5.0 秒
4. 选择测试视频
5. 选择保存目录
6. 开始处理

**预期行为**:
- [ ] 处理开始前显示"正在进行视频预处理..."
- [ ] 预处理成功显示"视频预处理完成: 去掉头部5.0秒, 尾部5.0秒"
- [ ] 继续正常的翻译流程
- [ ] 最终输出视频时长约为20秒（30-5-5）

#### 查看日志

检查日志中是否有：
```
正在进行视频预处理...
视频预处理完成: 去掉头部5.0秒, 尾部5.0秒
```

### 第八步：测试向量化服务（可选）

仅当您有有效的火山引擎API Key时测试。

#### 配置火山引擎

1. 打开配置对话框
2. 选择"火山引擎向量化服务"
3. 填写配置：
   ```
   API Key: 2cad3d85-a6a5-433e-9ac5-41598e1aae83
   Base URL: https://ark.cn-beijing.volces.com/api/v3
   Collection名称: video_summaries
   Embedding模型: ep-20241217191853-w54rf (替换为实际的)
   ```
4. 点击"测试连接"

**预期结果**:
- [ ] LLM连接测试成功
- [ ] 火山引擎向量化服务连接成功（如果endpoint ID正确）

#### 运行测试脚本

```bash
# 在激活虚拟环境后
python test_volcengine_vector.py
```

**预期输出**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
火山引擎向量化服务测试
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

测试1: 基本连接测试
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 连接测试成功！

测试2: 文本向量化
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 向量化成功!
   - 向量维度: 1024

...

总计: 4/4 个测试通过
🎉 所有测试通过!
```

## 🐛 常见问题排查

### 问题1: 程序启动失败

**错误**: `ModuleNotFoundError: No module named 'PySide6'`

**解决**:
```bash
# 确保激活了虚拟环境
venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt
```

### 问题2: 配置按钮不存在

**检查**:
1. 确认使用的是HTML UI界面
2. 刷新浏览器页面（Ctrl+F5）
3. 检查 `videotrans/webui/index.html` 文件是否包含配置按钮

### 问题3: 点击配置按钮没反应

**调试步骤**:
1. 打开浏览器开发者工具（F12）
2. 查看Console标签的错误
3. 检查 `videotrans/webui/app.js` 中的事件绑定
4. 确认 `videotrans/ui/webbridge.py` 的修复已保存

### 问题4: 配置对话框内容显示不全

**可能原因**:
1. UI组件初始化失败
2. 样式加载问题
3. 配置文件格式错误

**解决**:
1. 检查控制台错误
2. 删除 `hearsight_config.json` 重新创建
3. 重启程序

### 问题5: 视频预处理不工作

**检查项**:
1. 确认勾选了"视频预处理"复选框
2. 确认设置了头部或尾部秒数（非0）
3. 查看日志中是否有预处理相关信息
4. 确认FFmpeg可用

## 📋 验证结果记录

### 验证日期: _______________

### 环境信息

- 操作系统: _______________
- Python版本: _______________
- 虚拟环境: [ ] 已激活 [ ] 未激活

### 功能验证结果

#### 视频预处理
- [ ] UI显示正常
- [ ] 参数可设置
- [ ] 功能正常工作
- [ ] 日志正确输出

#### 配置按钮
- [ ] HTML UI按钮显示
- [ ] Qt UI按钮显示
- [ ] 按钮可点击
- [ ] 对话框正常打开

#### 配置对话框
- [ ] LLM配置正常
- [ ] 段落合并配置正常
- [ ] 向量化配置正常
- [ ] 保存功能正常
- [ ] 配置持久化正常

#### 火山引擎向量化
- [ ] 配置项正常显示
- [ ] 测试连接功能正常
- [ ] 向量化功能正常（如果测试）

### 发现的问题

1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

### 备注

_______________________________________________
_______________________________________________
_______________________________________________

## ✅ 验证通过标准

所有以下项目必须通过：
- ✅ 程序正常启动
- ✅ 视频预处理UI正常显示
- ✅ 配置按钮正常工作
- ✅ 配置对话框完整显示
- ✅ 配置可以保存和恢复
- ✅ 没有严重错误或崩溃

## 🎉 验证完成

如果所有项目都通过，恭喜！所有功能已正常工作。

如果有任何问题，请参考以下文档：
- [问题修复说明](./问题修复说明.md)
- [功能更新总结](./功能更新总结.md)
- [向量化服务配置界面使用说明](./向量化服务配置界面使用说明.md)

或在GitHub仓库提交Issue。
