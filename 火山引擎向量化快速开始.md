# ç«å±±å¼•æ“å‘é‡åŒ–æœåŠ¡ - å¿«é€Ÿå¼€å§‹æŒ‡å—

## 1. é…ç½®å‘é‡åŒ–æœåŠ¡

### æ­¥éª¤1: æ‰“å¼€é…ç½®ç•Œé¢

1. å¯åŠ¨ pyvideotrans åº”ç”¨ç¨‹åº
2. ç‚¹å‡»ä¸»ç•Œé¢çš„ "æ™ºèƒ½æ‘˜è¦é…ç½®" æŒ‰é’®ï¼ˆé€šå¸¸åœ¨é¡¶éƒ¨å·¥å…·æ æˆ–èœå•ä¸­ï¼‰

### æ­¥éª¤2: é…ç½®ç«å±±å¼•æ“å‚æ•°

åœ¨ "å‘é‡åŒ–æœåŠ¡é…ç½®" éƒ¨åˆ†ï¼š

1. **é€‰æ‹©å‘é‡å­˜å‚¨ç±»å‹**: ä»ä¸‹æ‹‰èœå•é€‰æ‹© "ç«å±±å¼•æ“å‘é‡åŒ–æœåŠ¡"

2. **å¡«å†™APIé…ç½®**:
   ```
   ğŸ”‘ API Key: 2cad3d85-a6a5-433e-9ac5-41598e1aae83
   ğŸŒ Base URL: https://ark.cn-beijing.volces.com/api/v3
   ğŸ“š Collectionåç§°: video_summaries
   ğŸ¤– Embeddingæ¨¡å‹: ep-20241217191853-w54rf
   ```

   > âš ï¸ æ³¨æ„: Embeddingæ¨¡å‹éœ€è¦å¡«å†™æ‚¨åœ¨ç«å±±å¼•æ“æ§åˆ¶å°åˆ›å»ºçš„endpoint ID

3. **æµ‹è¯•è¿æ¥**: ç‚¹å‡» "æµ‹è¯•è¿æ¥" æŒ‰é’®éªŒè¯é…ç½®

4. **ä¿å­˜é…ç½®**: ç‚¹å‡» "ä¿å­˜é…ç½®" æŒ‰é’®

## 2. ä½¿ç”¨å‘é‡åŒ–å­˜å‚¨

### è‡ªåŠ¨å­˜å‚¨ï¼ˆæ¨èï¼‰

å½“æ‚¨ç¿»è¯‘è§†é¢‘å¹¶å¯ç”¨ "æ™ºèƒ½æ‘˜è¦" åŠŸèƒ½æ—¶ï¼š

1. å‹¾é€‰ä¸»ç•Œé¢çš„ "æ™ºèƒ½æ‘˜è¦" å¤é€‰æ¡†
2. å¼€å§‹è§†é¢‘ç¿»è¯‘ä»»åŠ¡
3. ç¿»è¯‘å®Œæˆåï¼Œæ‘˜è¦ä¼šè‡ªåŠ¨å‘é‡åŒ–å¹¶å­˜å‚¨

### æ‰‹åŠ¨å­˜å‚¨ï¼ˆç¼–ç¨‹æ–¹å¼ï¼‰

```python
from videotrans.hearsight.vector_store import get_vector_store

# è·å–å‘é‡å­˜å‚¨å®ä¾‹
vector_store = get_vector_store()

# å­˜å‚¨è§†é¢‘æ‘˜è¦
vector_store.store_summary(
    video_path="/path/to/your/video.mp4",
    summary={
        "topic": "è§†é¢‘ä¸»é¢˜",
        "summary": "è§†é¢‘æ€»ç»“å†…å®¹",
        "total_duration": 300.5
    },
    paragraphs=[
        {
            "text": "æ®µè½å®Œæ•´æ–‡æœ¬",
            "summary": "æ®µè½æ‘˜è¦",
            "start_time": 0.0,
            "end_time": 10.0
        }
        # ... æ›´å¤šæ®µè½
    ]
)
```

## 3. è¯­ä¹‰æ£€ç´¢

### æœç´¢ç›¸å…³å†…å®¹

```python
from videotrans.hearsight.vector_store import get_vector_store

# è·å–å‘é‡å­˜å‚¨å®ä¾‹
vector_store = get_vector_store()

# æœç´¢ç›¸å…³å†…å®¹
results = vector_store.search(
    query="ç”¨æˆ·çš„é—®é¢˜æˆ–æŸ¥è¯¢å…³é”®è¯",
    n_results=5  # è¿”å›å‰5ä¸ªæœ€ç›¸å…³çš„ç»“æœ
)

# å¤„ç†ç»“æœ
for result in results:
    print(f"ç›¸ä¼¼åº¦: {result['similarity']:.4f}")
    print(f"å†…å®¹: {result['document']}")
    print(f"è§†é¢‘è·¯å¾„: {result['metadata']['video_path']}")
    print(f"æ—¶é—´èŒƒå›´: {result['metadata'].get('start_time', 'N/A')} - {result['metadata'].get('end_time', 'N/A')}")
    print("-" * 60)
```

### åœ¨ç‰¹å®šè§†é¢‘ä¸­æœç´¢

```python
# åªåœ¨ç‰¹å®šè§†é¢‘ä¸­æœç´¢
results = vector_store.search(
    query="æŸ¥è¯¢å†…å®¹",
    n_results=5,
    video_id="è§†é¢‘çš„MD5å“ˆå¸ŒID"  # å¯é€šè¿‡ _generate_video_id() ç”Ÿæˆ
)
```

### åªæœç´¢æ®µè½æˆ–æ•´ä½“æ‘˜è¦

```python
# åªæœç´¢æ®µè½
results = vector_store.search(
    query="æŸ¥è¯¢å†…å®¹",
    n_results=5,
    filter_type="paragraph"
)

# åªæœç´¢æ•´ä½“æ‘˜è¦
results = vector_store.search(
    query="æŸ¥è¯¢å†…å®¹",
    n_results=5,
    filter_type="overall_summary"
)
```

## 4. ç®¡ç†å‘é‡æ•°æ®

### æŸ¥çœ‹æ‰€æœ‰å·²å­˜å‚¨çš„è§†é¢‘

```python
from videotrans.hearsight.vector_store import get_vector_store

vector_store = get_vector_store()
videos = vector_store.list_all_videos()

for video in videos:
    print(f"è§†é¢‘: {video['video_path']}")
    print(f"ä¸»é¢˜: {video['topic']}")
    print(f"æ®µè½æ•°: {video['paragraph_count']}")
    print(f"æ—¶é•¿: {video['total_duration']}ç§’")
    print("-" * 60)
```

### è·å–ç‰¹å®šè§†é¢‘çš„æ‘˜è¦

```python
from videotrans.hearsight.vector_store import get_vector_store

vector_store = get_vector_store()
summary_data = vector_store.get_video_summary("/path/to/video.mp4")

if summary_data:
    print(f"ä¸»é¢˜: {summary_data['summary']['topic']}")
    print(f"æ‘˜è¦: {summary_data['summary']['summary']}")
    print(f"æ®µè½æ•°: {len(summary_data['paragraphs'])}")
```

### åˆ é™¤è§†é¢‘æ‘˜è¦

```python
from videotrans.hearsight.vector_store import get_vector_store

vector_store = get_vector_store()
success = vector_store.delete_video("/path/to/video.mp4")

if success:
    print("âœ… åˆ é™¤æˆåŠŸ")
else:
    print("âŒ åˆ é™¤å¤±è´¥æˆ–è§†é¢‘ä¸å­˜åœ¨")
```

## 5. è¿è¡Œæµ‹è¯•

### ä½¿ç”¨æµ‹è¯•è„šæœ¬

é¡¹ç›®æ ¹ç›®å½•æä¾›äº†æµ‹è¯•è„šæœ¬ `test_volcengine_vector.py`ï¼š

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆWindowsï¼‰
venv\Scripts\activate

# è¿è¡Œæµ‹è¯•
python test_volcengine_vector.py
```

æµ‹è¯•è„šæœ¬ä¼šæ‰§è¡Œï¼š
- âœ… åŸºæœ¬è¿æ¥æµ‹è¯•
- âœ… æ–‡æœ¬å‘é‡åŒ–æµ‹è¯•
- âœ… æ‰¹é‡å‘é‡åŒ–æµ‹è¯•
- âœ… å­˜å‚¨å’Œæ£€ç´¢æµ‹è¯•

## 6. æ•°æ®å­˜å‚¨ä½ç½®

å‘é‡åŒ–æ•°æ®å­˜å‚¨åœ¨ï¼š

```
é¡¹ç›®æ ¹ç›®å½•/
â””â”€â”€ vector_db/
    â””â”€â”€ volcengine/
        â”œâ”€â”€ [video_id_1].json
        â”œâ”€â”€ [video_id_2].json
        â””â”€â”€ ...
```

æ¯ä¸ªJSONæ–‡ä»¶åŒ…å«ï¼š
- è§†é¢‘å…ƒä¿¡æ¯
- å®Œæ•´æ‘˜è¦å†…å®¹
- æ‰€æœ‰æ®µè½çš„å‘é‡å’Œå…ƒæ•°æ®

## 7. åˆ‡æ¢å‘é‡å­˜å‚¨åç«¯

### ä»ChromaDBåˆ‡æ¢åˆ°ç«å±±å¼•æ“

1. æ‰“å¼€ "æ™ºèƒ½æ‘˜è¦é…ç½®"
2. é€‰æ‹© "ç«å±±å¼•æ“å‘é‡åŒ–æœåŠ¡"
3. å¡«å†™é…ç½®å¹¶ä¿å­˜

### ä»ç«å±±å¼•æ“åˆ‡æ¢å›ChromaDB

1. æ‰“å¼€ "æ™ºèƒ½æ‘˜è¦é…ç½®"
2. é€‰æ‹© "ChromaDB (æœ¬åœ°)"
3. ä¿å­˜é…ç½®

> ğŸ’¡ æç¤º: åˆ‡æ¢åç«¯åï¼Œéœ€è¦é‡æ–°ç”Ÿæˆå‘é‡æ•°æ®

### ç¼–ç¨‹æ–¹å¼é‡ç½®åç«¯

```python
from videotrans.hearsight.vector_store import reset_vector_store, get_vector_store

# é‡ç½®å½“å‰å®ä¾‹
reset_vector_store()

# å¼ºåˆ¶ä½¿ç”¨ç‰¹å®šåç«¯
vector_store = get_vector_store(force_backend='volcengine')
# æˆ–
vector_store = get_vector_store(force_backend='chromadb')
```

## 8. å¸¸è§é—®é¢˜

### Q: Embeddingæ¨¡å‹endpoint IDåœ¨å“ªé‡Œè·å–ï¼Ÿ

A: ç™»å½•ç«å±±å¼•æ“æ§åˆ¶å° â†’ ç«å±±æ–¹èˆŸ â†’ æ¨ç†æ¥å…¥ â†’ åˆ›å»ºæ¨ç†æ¥å…¥ç‚¹ â†’ å¤åˆ¶endpoint ID

### Q: API Keyæœ‰ä»€ä¹ˆæƒé™è¦æ±‚ï¼Ÿ

A: API Keyéœ€è¦æœ‰è®¿é—®Embedding APIçš„æƒé™

### Q: å‘é‡æ•°æ®å¯ä»¥è¿ç§»å—ï¼Ÿ

A: å¯ä»¥ã€‚JSONæ–‡ä»¶å¯ç›´æ¥å¤åˆ¶åˆ°å…¶ä»–ç¯å¢ƒçš„ `vector_db/volcengine/` ç›®å½•ä¸‹

### Q: æ”¯æŒå“ªäº›Embeddingæ¨¡å‹ï¼Ÿ

A: æ”¯æŒç«å±±å¼•æ“æä¾›çš„æ‰€æœ‰Embeddingæ¨¡å‹ï¼Œåªéœ€é…ç½®æ­£ç¡®çš„endpoint ID

### Q: å¦‚ä½•æé«˜æ£€ç´¢å‡†ç¡®åº¦ï¼Ÿ

A:
1. ä½¿ç”¨æ›´é«˜è´¨é‡çš„Embeddingæ¨¡å‹
2. ä¼˜åŒ–æŸ¥è¯¢å…³é”®è¯
3. è°ƒæ•´è¿”å›ç»“æœæ•°é‡
4. ä½¿ç”¨ç±»å‹è¿‡æ»¤ï¼ˆåªæœç´¢æ®µè½æˆ–æ•´ä½“æ‘˜è¦ï¼‰

## 9. é«˜çº§ç”¨æ³•

### å®ç°æ™ºèƒ½é—®ç­”

```python
from videotrans.hearsight.vector_store import get_vector_store
from videotrans.hearsight.chat_client import chat_with_context

def answer_question(question: str, video_path: str = None):
    """
    åŸºäºå‘é‡æ£€ç´¢çš„æ™ºèƒ½é—®ç­”

    Args:
        question: ç”¨æˆ·é—®é¢˜
        video_path: é™å®šåœ¨ç‰¹å®šè§†é¢‘ä¸­æœç´¢ï¼ˆå¯é€‰ï¼‰
    """
    # 1. æ£€ç´¢ç›¸å…³å†…å®¹
    vector_store = get_vector_store()

    video_id = None
    if video_path:
        import hashlib
        video_id = hashlib.md5(video_path.encode('utf-8')).hexdigest()

    results = vector_store.search(
        query=question,
        n_results=3,
        video_id=video_id
    )

    # 2. æ„å»ºä¸Šä¸‹æ–‡
    context_parts = []
    for result in results:
        context_parts.append(f"å†…å®¹: {result['document']}")
        if 'start_time' in result['metadata']:
            context_parts.append(f"æ—¶é—´: {result['metadata']['start_time']}s - {result['metadata']['end_time']}s")
        context_parts.append("")

    context = "\n".join(context_parts)

    # 3. è°ƒç”¨LLMç”Ÿæˆç­”æ¡ˆ
    prompt = f"""åŸºäºä»¥ä¸‹è§†é¢‘å†…å®¹ç‰‡æ®µå›ç­”é—®é¢˜ã€‚

ç›¸å…³å†…å®¹:
{context}

é—®é¢˜: {question}

è¯·æä¾›å‡†ç¡®ã€ç®€æ´çš„ç­”æ¡ˆ:"""

    answer = chat_with_context(prompt)

    return {
        "answer": answer,
        "sources": results
    }


# ä½¿ç”¨ç¤ºä¾‹
result = answer_question("è§†é¢‘è®²äº†ä»€ä¹ˆå†…å®¹ï¼Ÿ")
print(f"ç­”æ¡ˆ: {result['answer']}")
print(f"\nå‚è€ƒæ¥æº: {len(result['sources'])} ä¸ªç›¸å…³ç‰‡æ®µ")
```

### æ‰¹é‡å¤„ç†è§†é¢‘

```python
import os
from videotrans.hearsight.vector_store import get_vector_store

def batch_process_videos(video_dir: str):
    """æ‰¹é‡å¤„ç†ç›®å½•ä¸‹çš„æ‰€æœ‰è§†é¢‘æ‘˜è¦"""
    vector_store = get_vector_store()

    for filename in os.listdir(video_dir):
        if filename.endswith(('.mp4', '.avi', '.mkv')):
            video_path = os.path.join(video_dir, filename)

            # æ£€æŸ¥æ˜¯å¦å·²å¤„ç†
            existing = vector_store.get_video_summary(video_path)
            if existing:
                print(f"â­ï¸  è·³è¿‡å·²å¤„ç†: {filename}")
                continue

            print(f"ğŸ“¹ å¤„ç†ä¸­: {filename}")

            # è¿™é‡Œæ·»åŠ æ‚¨çš„æ‘˜è¦ç”Ÿæˆé€»è¾‘
            # summary = generate_summary(video_path)
            # vector_store.store_summary(video_path, summary, paragraphs)
```

## 10. æœ€ä½³å®è·µ

1. **å®šæœŸå¤‡ä»½**: å®šæœŸå¤‡ä»½ `vector_db/volcengine/` ç›®å½•
2. **å‘½åè§„èŒƒ**: ä½¿ç”¨æœ‰æ„ä¹‰çš„Collectionåç§°
3. **æ•°æ®æ¸…ç†**: å®šæœŸåˆ é™¤ä¸éœ€è¦çš„å‘é‡æ•°æ®
4. **ç›‘æ§é…é¢**: å…³æ³¨APIè°ƒç”¨é…é¢ä½¿ç”¨æƒ…å†µ
5. **æµ‹è¯•ä¼˜å…ˆ**: åœ¨ç”Ÿäº§ç¯å¢ƒå‰å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯

## éœ€è¦å¸®åŠ©ï¼Ÿ

- ğŸ“– è¯¦ç»†æ–‡æ¡£: `ç«å±±å¼•æ“å‘é‡åŒ–æœåŠ¡é›†æˆè¯´æ˜.md`
- ğŸ§ª æµ‹è¯•è„šæœ¬: `test_volcengine_vector.py`
- ğŸ”— ç«å±±å¼•æ“æ–‡æ¡£: https://www.volcengine.com/docs/82379/1521766
