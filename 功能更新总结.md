# pyvideotrans åŠŸèƒ½æ›´æ–°æ€»ç»“

æ›´æ–°æ—¥æœŸ: 2025-10-11

## ğŸ‰ æ–°å¢åŠŸèƒ½

### 1. è§†é¢‘é¢„å¤„ç†åŠŸèƒ½ âœ…

**åŠŸèƒ½æè¿°**: åœ¨ç¿»è¯‘å¤„ç†å‰è‡ªåŠ¨è£å‰ªè§†é¢‘çš„å¤´éƒ¨å’Œå°¾éƒ¨ã€‚

**æ”¯æŒç•Œé¢**:
- âœ… HTML UI
- âœ… QtåŸç”ŸUI

**é…ç½®å‚æ•°**:
- `enable_preprocess`: å¯ç”¨/ç¦ç”¨é¢„å¤„ç†
- `trim_start`: å»æ‰å¤´éƒ¨ç§’æ•° (0-3600ï¼Œæ”¯æŒå°æ•°)
- `trim_end`: å»æ‰å°¾éƒ¨ç§’æ•° (0-3600ï¼Œæ”¯æŒå°æ•°)

**ä½¿ç”¨ä½ç½®**:
- **HTML UI**: åœ¨"è¾“å…¥ä¸è¾“å‡º"éƒ¨åˆ†ï¼Œ"æ™ºèƒ½æ‘˜è¦"ä¸‹æ–¹
- **Qt UI**: åœ¨ä¸»ç•Œé¢ä¸Šæ–¹åŒºåŸŸ

**ç¤ºä¾‹**:
```
â˜‘ï¸ è§†é¢‘é¢„å¤„ç†
å»æ‰å¤´éƒ¨(ç§’): 5.0
å»æ‰å°¾éƒ¨(ç§’): 10.0
```

**æŠ€æœ¯å®ç°**:
- ä½¿ç”¨FFmpeg `-ss` å’Œ `-t` å‚æ•°
- ç¼–ç å¤åˆ¶æ¨¡å¼ï¼Œå¤„ç†é€Ÿåº¦å¿«
- é¢„å¤„ç†åœ¨éŸ³è§†é¢‘åˆ†ç¦»å‰æ‰§è¡Œ
- å¤±è´¥æ—¶è‡ªåŠ¨é™çº§ä½¿ç”¨åŸè§†é¢‘

### 2. ç«å±±å¼•æ“å‘é‡åŒ–æœåŠ¡é›†æˆ âœ…

**åŠŸèƒ½æè¿°**: ä½¿ç”¨ç«å±±å¼•æ“çš„Embedding APIå¯¹è§†é¢‘æ‘˜è¦è¿›è¡Œå‘é‡åŒ–å­˜å‚¨å’Œè¯­ä¹‰æ£€ç´¢ã€‚

**æ ¸å¿ƒç‰¹æ€§**:
- âœ… æ”¯æŒå¤šç§å‘é‡å­˜å‚¨åç«¯ï¼ˆChromaDB + ç«å±±å¼•æ“ï¼‰
- âœ… æ··åˆæ¶æ„ï¼ˆäº‘ç«¯å‘é‡åŒ– + æœ¬åœ°JSONå­˜å‚¨ï¼‰
- âœ… æ‰¹é‡å‘é‡åŒ–å¤„ç†
- âœ… è¯­ä¹‰æ£€ç´¢åŠŸèƒ½
- âœ… å›¾å½¢åŒ–é…ç½®ç•Œé¢
- âœ… è¿æ¥æµ‹è¯•åŠŸèƒ½

**é…ç½®å…¥å£**:
- **HTML UI**: ç‚¹å‡»"æ™ºèƒ½æ‘˜è¦"æ—çš„ âš™ï¸ æŒ‰é’®
- **Qt UI**: ç‚¹å‡»ä¾§è¾¹æ çš„é…ç½®å›¾æ ‡

**é…ç½®å‚æ•°**:
```json
{
  "vector": {
    "type": "volcengine",
    "volcengine": {
      "api_key": "2cad3d85-a6a5-433e-9ac5-41598e1aae83",
      "base_url": "https://ark.cn-beijing.volces.com/api/v3",
      "collection_name": "video_summaries",
      "embedding_model": "ep-20241217191853-w54rf"
    }
  }
}
```

**æ•°æ®å­˜å‚¨ä½ç½®**:
```
é¡¹ç›®æ ¹ç›®å½•/
â””â”€â”€ vector_db/
    â”œâ”€â”€ chromadb/       # ChromaDBæ•°æ®
    â””â”€â”€ volcengine/     # ç«å±±å¼•æ“æ•°æ®
        â”œâ”€â”€ {video_id_1}.json
        â””â”€â”€ {video_id_2}.json
```

### 3. æ™ºèƒ½æ‘˜è¦é…ç½®ç•Œé¢å¢å¼º âœ…

**æ–°å¢é…ç½®é¡¹**:
- å‘é‡å­˜å‚¨ç±»å‹é€‰æ‹©
- ç«å±±å¼•æ“å‚æ•°é…ç½®
- è¿æ¥æµ‹è¯•åŠŸèƒ½å¢å¼º

**é…ç½®å¯¹è¯æ¡†ç»“æ„**:
```
âš™ï¸ æ™ºèƒ½æ‘˜è¦é…ç½®ä¸­å¿ƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¤– LLM API é…ç½®
  - API Key, Base URL, Model
  - Temperature, Timeout

ğŸ“ æ®µè½åˆå¹¶å‚æ•°
  - æœ€å¤§æ—¶é—´é—´éš”, æœ€å¤§æ®µè½æ—¶é•¿
  - æœ€å¤§å­—ç¬¦æ•°

ğŸ—„ï¸ å‘é‡åŒ–æœåŠ¡é…ç½® â­ NEW
  - å‘é‡å­˜å‚¨ç±»å‹
  - ç«å±±å¼•æ“å‚æ•°ï¼ˆæ¡ä»¶æ˜¾ç¤ºï¼‰

[ğŸ”Œ æµ‹è¯•è¿æ¥] [ğŸ’¾ ä¿å­˜é…ç½®] [âŒ å–æ¶ˆ]
```

## ğŸ“ æ–°å¢æ–‡ä»¶

### æ ¸å¿ƒåŠŸèƒ½æ–‡ä»¶

1. **videotrans/hearsight/volcengine_vector.py**
   - ç«å±±å¼•æ“å‘é‡åŒ–æœåŠ¡å®¢æˆ·ç«¯
   - æ–‡æœ¬å‘é‡åŒ–ï¼ˆå•ä¸ª/æ‰¹é‡ï¼‰
   - å‘é‡å­˜å‚¨å’Œæ£€ç´¢
   - æ•°æ®ç®¡ç†åŠŸèƒ½

### æµ‹è¯•æ–‡ä»¶

2. **test_volcengine_vector.py**
   - å®Œæ•´æµ‹è¯•å¥—ä»¶
   - 4ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ˆè¿æ¥ã€å‘é‡åŒ–ã€æ‰¹é‡ã€å­˜å‚¨æ£€ç´¢ï¼‰

### æ–‡æ¡£æ–‡ä»¶

3. **ç«å±±å¼•æ“å‘é‡åŒ–æœåŠ¡é›†æˆè¯´æ˜.md**
   - æŠ€æœ¯æ¶æ„è¯´æ˜
   - APIæ–‡æ¡£
   - é…ç½®è¯´æ˜
   - æ•…éšœæ’æŸ¥

4. **ç«å±±å¼•æ“å‘é‡åŒ–å¿«é€Ÿå¼€å§‹.md**
   - å¿«é€Ÿå…¥é—¨æŒ‡å—
   - ä½¿ç”¨ç¤ºä¾‹
   - å¸¸è§é—®é¢˜
   - æœ€ä½³å®è·µ

5. **è§†é¢‘é¢„å¤„ç†åŠŸèƒ½è¯´æ˜.md**
   - åŠŸèƒ½è¯¦ç»†è¯´æ˜
   - ä½¿ç”¨åœºæ™¯
   - æŠ€æœ¯ç»†èŠ‚
   - å¸¸è§é—®é¢˜

6. **å‘é‡åŒ–æœåŠ¡é…ç½®ç•Œé¢ä½¿ç”¨è¯´æ˜.md**
   - é…ç½®ç•Œé¢æ“ä½œæŒ‡å—
   - å®Œæ•´é…ç½®ç¤ºä¾‹
   - å®‰å…¨å»ºè®®
   - é«˜çº§æŠ€å·§

7. **åŠŸèƒ½æ›´æ–°æ€»ç»“.md** (æœ¬æ–‡ä»¶)
   - æ›´æ–°æ€»è§ˆ
   - æ–‡ä»¶æ¸…å•
   - ä½¿ç”¨æŒ‡å—

## ğŸ“ ä¿®æ”¹æ–‡ä»¶

### UIç›¸å…³

1. **videotrans/ui/en.py**
   - æ·»åŠ è§†é¢‘é¢„å¤„ç†UIæ§ä»¶ï¼ˆQtç•Œé¢ï¼‰

2. **videotrans/webui/index.html**
   - æ·»åŠ è§†é¢‘é¢„å¤„ç†æ§ä»¶ï¼ˆHTMLç•Œé¢ï¼‰
   - æ·»åŠ æ™ºèƒ½æ‘˜è¦é…ç½®æŒ‰é’®

3. **videotrans/webui/app.js**
   - ç»‘å®šé¢„å¤„ç†å‚æ•°
   - ç»‘å®šé…ç½®æŒ‰é’®äº‹ä»¶
   - æ·»åŠ æ•°æ®åŒæ­¥é€»è¾‘

4. **videotrans/ui/hearsight_config.py**
   - æ·»åŠ å‘é‡åŒ–æœåŠ¡é…ç½®UI
   - ç«å±±å¼•æ“å‚æ•°è¡¨å•
   - å¢å¼ºæµ‹è¯•è¿æ¥åŠŸèƒ½
   - é…ç½®åŠ è½½å’Œä¿å­˜

5. **videotrans/ui/webbridge.py**
   - æ·»åŠ  `openHearSightConfig()` æ–¹æ³•
   - è¿æ¥HTML UIå’ŒQtå¯¹è¯æ¡†

### æ ¸å¿ƒé€»è¾‘

6. **videotrans/hearsight/vector_store.py**
   - æ·»åŠ å¤šåç«¯æ”¯æŒ
   - `get_vector_store()` è‡ªåŠ¨é€‰æ‹©åç«¯
   - `reset_vector_store()` é‡ç½®å®ä¾‹

7. **videotrans/task/trans_create.py**
   - åœ¨ `prepare()` ä¸­æ·»åŠ é¢„å¤„ç†è°ƒç”¨
   - å®ç° `_preprocess_trim_video()` æ–¹æ³•

### é…ç½®ç³»ç»Ÿ

8. **videotrans/mainwin/_main_win.py**
   - åŠ è½½é¢„å¤„ç†é…ç½®å‚æ•°
   - åˆå§‹åŒ–UIæ§ä»¶å€¼
   - è¿æ¥é…ç½®å¯¹è¯æ¡†

9. **videotrans/mainwin/_actions.py**
   - ä¿å­˜é¢„å¤„ç†å‚æ•°åˆ°é…ç½®

10. **videotrans/configure/_config_loader.py**
    - æ·»åŠ é¢„å¤„ç†é»˜è®¤é…ç½®
    - æ·»åŠ å‘é‡åŒ–æœåŠ¡é…ç½®ç»“æ„

## ğŸ”§ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ç»“æ„

**hearsight_config.json** (æ–°å¢):
```json
{
  "llm": {
    "api_key": "...",
    "base_url": "...",
    "model": "...",
    "temperature": 0.3,
    "timeout": 120
  },
  "merge": {
    "max_gap": 2.0,
    "max_duration": 30.0,
    "max_chars": 200
  },
  "vector": {
    "type": "chromadb|volcengine",
    "volcengine": {
      "api_key": "...",
      "base_url": "...",
      "collection_name": "...",
      "embedding_model": "..."
    }
  }
}
```

**params.json** (æ‰©å±•):
```json
{
  "enable_preprocess": false,
  "trim_start": 0,
  "trim_end": 0,
  ...
}
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹ - è§†é¢‘é¢„å¤„ç†

1. å¯åŠ¨ç¨‹åº
2. åœ¨HTML UIç•Œé¢æ‰¾åˆ°"è§†é¢‘é¢„å¤„ç†"
3. å‹¾é€‰å¹¶è®¾ç½®å¤´å°¾ç§’æ•°
4. æ­£å¸¸å¤„ç†è§†é¢‘

### å¿«é€Ÿå¼€å§‹ - ç«å±±å¼•æ“å‘é‡åŒ–

1. ç‚¹å‡»æ™ºèƒ½æ‘˜è¦æ—çš„ âš™ï¸ é…ç½®æŒ‰é’®
2. é€‰æ‹©"å‘é‡å­˜å‚¨ç±»å‹" â†’ "ç«å±±å¼•æ“å‘é‡åŒ–æœåŠ¡"
3. å¡«å†™é…ç½®å‚æ•°ï¼š
   - API Key: `2cad3d85-a6a5-433e-9ac5-41598e1aae83`
   - Base URL: `https://ark.cn-beijing.volces.com/api/v3`
   - Embeddingæ¨¡å‹: æ‚¨çš„endpoint ID
4. ç‚¹å‡»"æµ‹è¯•è¿æ¥"éªŒè¯
5. ä¿å­˜é…ç½®

### è¿è¡Œæµ‹è¯•

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
venv\Scripts\activate  # Windows
source venv/bin/activate  # Linux/Mac

# è¿è¡Œå‘é‡åŒ–æµ‹è¯•
python test_volcengine_vector.py
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: å»é™¤ç‰‡å¤´ç‰‡å°¾åç¿»è¯‘

```
æ­¥éª¤:
1. å‹¾é€‰"è§†é¢‘é¢„å¤„ç†"
2. è®¾ç½®å»æ‰å¤´éƒ¨5ç§’ï¼Œå°¾éƒ¨10ç§’
3. é€‰æ‹©è§†é¢‘å¹¶ç¿»è¯‘
4. è¾“å‡ºè§†é¢‘å·²è‡ªåŠ¨å»é™¤å¤´å°¾
```

### åœºæ™¯2: è¯­ä¹‰æ£€ç´¢è§†é¢‘å†…å®¹

```
æ­¥éª¤:
1. é…ç½®ç«å±±å¼•æ“å‘é‡åŒ–æœåŠ¡
2. ç¿»è¯‘è§†é¢‘å¹¶å¯ç”¨"æ™ºèƒ½æ‘˜è¦"
3. æ‘˜è¦è‡ªåŠ¨å‘é‡åŒ–å­˜å‚¨
4. ä½¿ç”¨ä»£ç è¿›è¡Œè¯­ä¹‰æ£€ç´¢:

from videotrans.hearsight.vector_store import get_vector_store

vector_store = get_vector_store()
results = vector_store.search("è§†é¢‘è®²äº†ä»€ä¹ˆï¼Ÿ", n_results=5)
for result in results:
    print(result['document'])
    print(result['similarity'])
```

### åœºæ™¯3: æ‰¹é‡è§†é¢‘å¤„ç†å’Œæ£€ç´¢

```python
# æ‰¹é‡å¤„ç†å¤šä¸ªè§†é¢‘
videos = ["video1.mp4", "video2.mp4", "video3.mp4"]

for video in videos:
    # ç¿»è¯‘å¹¶ç”Ÿæˆæ‘˜è¦ï¼ˆå¯ç”¨æ™ºèƒ½æ‘˜è¦ï¼‰
    process_video(video)

# è·¨è§†é¢‘è¯­ä¹‰æ£€ç´¢
from videotrans.hearsight.vector_store import get_vector_store

vector_store = get_vector_store()
results = vector_store.search("æœºå™¨å­¦ä¹ ç›¸å…³å†…å®¹", n_results=10)

# ç»“æœä¼šåŒ…å«æ‰€æœ‰ç›¸å…³è§†é¢‘çš„ç‰‡æ®µ
for result in results:
    video_path = result['metadata']['video_path']
    time_range = f"{result['metadata']['start_time']}-{result['metadata']['end_time']}"
    print(f"è§†é¢‘: {video_path}, æ—¶é—´: {time_range}")
```

## ğŸ”„ APIå˜åŒ–

### æ–°å¢API

1. **WebBridge.openHearSightConfig()**
   - ä»HTML UIæ‰“å¼€é…ç½®å¯¹è¯æ¡†
   - è¿”å›: `{"success": bool, "message": str}`

2. **VolcengineVectorClientç±»**
   - `__init__(api_key, base_url, collection_name, embedding_model)`
   - `store_summary(video_path, summary, paragraphs)`
   - `search(query, n_results, video_id, filter_type)`
   - `delete_video(video_path)`
   - `get_video_summary(video_path)`
   - `list_all_videos()`
   - `test_connection()`

3. **vector_storeæ¨¡å—**
   - `get_vector_store(persist_directory, force_backend)` - å¢å¼º
   - `reset_vector_store()` - æ–°å¢

### ä¿®æ”¹çš„API

1. **TransCreate.prepare()**
   - æ–°å¢è§†é¢‘é¢„å¤„ç†æ­¥éª¤
   - åœ¨éŸ³è§†é¢‘åˆ†ç¦»å‰æ‰§è¡Œ

2. **get_vector_store()**
   - æ·»åŠ  `force_backend` å‚æ•°
   - æ”¯æŒè‡ªåŠ¨é€‰æ‹©åç«¯

## âš ï¸ æ³¨æ„äº‹é¡¹

### è§†é¢‘é¢„å¤„ç†

1. **ç²¾åº¦é—®é¢˜**: ä½¿ç”¨ç¼–ç å¤åˆ¶æ¨¡å¼ï¼Œå—å…³é”®å¸§ä½ç½®å½±å“
2. **æ—¶é•¿éªŒè¯**: ç¡®ä¿ `trim_start + trim_end < è§†é¢‘æ€»æ—¶é•¿`
3. **é”™è¯¯å®¹é”™**: é¢„å¤„ç†å¤±è´¥ä¸ä¼šä¸­æ–­ç¿»è¯‘æµç¨‹

### ç«å±±å¼•æ“å‘é‡åŒ–

1. **APIé…é¢**: æ³¨æ„ç›‘æ§APIè°ƒç”¨é…é¢
2. **æ•°æ®éšç§**: å‘é‡æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ï¼ŒåŸå§‹æ–‡æœ¬ä¼šå‘é€åˆ°ç«å±±å¼•æ“
3. **åç«¯åˆ‡æ¢**: åˆ‡æ¢å‘é‡å­˜å‚¨åç«¯éœ€è¦é‡æ–°ç”Ÿæˆå‘é‡æ•°æ®
4. **æ¨¡å‹é€‰æ‹©**: ä¸åŒembeddingæ¨¡å‹ç”Ÿæˆçš„å‘é‡ç»´åº¦å¯èƒ½ä¸åŒ

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### è§†é¢‘é¢„å¤„ç†

- ä½¿ç”¨ `-c:v copy -c:a copy` å¿«é€Ÿå¤„ç†
- é€šå¸¸å‡ ç§’å†…å®Œæˆ
- å¯¹æ•´ä½“å¤„ç†æ—¶é—´å½±å“å¾ˆå°

### å‘é‡åŒ–æœåŠ¡

- æ”¯æŒæ‰¹é‡å‘é‡åŒ–API
- æœ¬åœ°å­˜å‚¨é¿å…é‡å¤ç½‘ç»œè¯·æ±‚
- ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—é«˜æ•ˆ

## ğŸ“Š å…¼å®¹æ€§

### ç•Œé¢å…¼å®¹

- âœ… HTML UI (æ¨è)
- âœ… QtåŸç”ŸUI
- âœ… ä¸¤ç§ç•Œé¢åŠŸèƒ½å®Œå…¨ä¸€è‡´

### ç³»ç»Ÿå…¼å®¹

- âœ… Windows
- âœ… macOS
- âœ… Linux

### Pythonç‰ˆæœ¬

- è¦æ±‚: Python 3.10+
- ä¾èµ–: è§ `requirements.txt`

## ğŸ”® æœªæ¥è®¡åˆ’

### å¯èƒ½çš„å¢å¼º

1. **è§†é¢‘é¢„å¤„ç†**
   - æ”¯æŒè£å‰ªä¸­é—´éƒ¨åˆ†
   - ç²¾ç¡®å¸§çº§è£å‰ªé€‰é¡¹
   - é¢„è§ˆè£å‰ªæ•ˆæœ

2. **å‘é‡åŒ–æœåŠ¡**
   - æ”¯æŒæ›´å¤šå‘é‡æ•°æ®åº“ï¼ˆFAISS, Milvusç­‰ï¼‰
   - æ··åˆæ£€ç´¢ï¼ˆå‘é‡+å…³é”®è¯ï¼‰
   - å¤šè¯­è¨€å‘é‡åŒ–æ”¯æŒ
   - å‘é‡æ•°æ®å¯¼å…¥å¯¼å‡º

3. **é…ç½®ç®¡ç†**
   - å¤šé…ç½®æ–‡ä»¶åˆ‡æ¢
   - é…ç½®æ¨¡æ¿
   - äº‘ç«¯é…ç½®åŒæ­¥

## ğŸ“ æ”¯æŒä¸åé¦ˆ

### è·å–å¸®åŠ©

1. æŸ¥çœ‹ç›¸å…³æ–‡æ¡£
2. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
3. åœ¨GitHubæäº¤Issue

### æ–‡æ¡£ç´¢å¼•

- [è§†é¢‘é¢„å¤„ç†åŠŸèƒ½è¯´æ˜](./è§†é¢‘é¢„å¤„ç†åŠŸèƒ½è¯´æ˜.md)
- [ç«å±±å¼•æ“å‘é‡åŒ–æœåŠ¡é›†æˆè¯´æ˜](./ç«å±±å¼•æ“å‘é‡åŒ–æœåŠ¡é›†æˆè¯´æ˜.md)
- [ç«å±±å¼•æ“å‘é‡åŒ–å¿«é€Ÿå¼€å§‹](./ç«å±±å¼•æ“å‘é‡åŒ–å¿«é€Ÿå¼€å§‹.md)
- [å‘é‡åŒ–æœåŠ¡é…ç½®ç•Œé¢ä½¿ç”¨è¯´æ˜](./å‘é‡åŒ–æœåŠ¡é…ç½®ç•Œé¢ä½¿ç”¨è¯´æ˜.md)

### è´¡çŒ®ä»£ç 

æ¬¢è¿æäº¤Pull Requestï¼

---

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-10-11
**ç»´æŠ¤è€…**: Claude Code Assistant
