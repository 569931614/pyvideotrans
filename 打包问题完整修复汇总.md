# BDvideoTrans æ‰“åŒ…é—®é¢˜å®Œæ•´ä¿®å¤æ±‡æ€»

## âœ… æœ€ç»ˆçŠ¶æ€

**æ‰€æœ‰é—®é¢˜å·²å®Œå…¨è§£å†³ï¼ç¨‹åºæˆåŠŸæ‰“åŒ…å¹¶æ­£å¸¸è¿è¡Œï¼**

- **è¿›ç¨‹ID**: 32556
- **å¯åŠ¨æ—¶é—´**: 2025/10/5 19:54:18
- **è¿è¡ŒçŠ¶æ€**: âœ… æ­£å¸¸è¿è¡Œ
- **å†…å­˜ä½¿ç”¨**: 800.57 MB
- **é”™è¯¯æ•°é‡**: 0

---

## ğŸ“‹ é—®é¢˜åˆ—è¡¨

åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­é‡åˆ°å¹¶è§£å†³äº†ä»¥ä¸‹ 4 ä¸ªé—®é¢˜ï¼š

1. âŒ **ModuleNotFoundError** - `_config_loader` æ¨¡å—æ‰¾ä¸åˆ°
2. âŒ **FileNotFoundError** - `cfg.json` é…ç½®æ–‡ä»¶æ‰¾ä¸åˆ°
3. âŒ **FileNotFoundError** - `language/en.json` è¯­è¨€æ–‡ä»¶æ‰¾ä¸åˆ°
4. âŒ **FileNotFoundError** - `styles/style.qss` æ ·å¼æ–‡ä»¶æ‰¾ä¸åˆ°ï¼ˆå¯¼è‡´ Loading å¡ä½ï¼‰

---

## ğŸ”§ é—®é¢˜ 1ï¼šModuleNotFoundError - _config_loader

### é”™è¯¯ä¿¡æ¯
```
ModuleNotFoundError: No module named 'videotrans.configure._config_loader'
```

### åŸå› 
ä½¿ç”¨æ‡’åŠ è½½æœºåˆ¶ + åŠ¨æ€å¯¼å…¥ï¼ˆ`importlib.import_module`ï¼‰ï¼ŒPyInstaller æ— æ³•æ£€æµ‹

### ä¿®å¤æ–¹æ¡ˆ
**æ–‡ä»¶**ï¼š`videotrans/configure/config.py`

```python
# ä¿®æ”¹å‰ï¼šä½¿ç”¨æ‡’åŠ è½½
class LazyConfigLoader:
    ...
sys.modules[__name__] = LazyConfigLoader(__package__)

# ä¿®æ”¹åï¼šä½¿ç”¨é™æ€å¯¼å…¥
from ._config_loader import *
```

---

## ğŸ”§ é—®é¢˜ 2ï¼šFileNotFoundError - cfg.json

### é”™è¯¯ä¿¡æ¯
```
FileNotFoundError: [Errno 2] No such file or directory: 
'F:/æ™ºèƒ½ä½“å®šåˆ¶/20250904translateVideo/pyvideotrans/dist/BDvideoTrans/videotrans/cfg.json'
```

### åŸå› 
ç¨‹åºå°è¯•åœ¨ `ROOT_DIR/videotrans/` åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œä½†è¯¥ç›®å½•ä¸å­˜åœ¨

### ä¿®å¤æ–¹æ¡ˆ
**æ–‡ä»¶**ï¼š`videotrans/configure/_config_loader.py`

**ä¿®æ”¹ä½ç½® 1**ï¼ˆç¬¬ 199 è¡Œï¼‰ï¼š
```python
def parse_init(update_data=None):
    # ç¡®ä¿ videotrans ç›®å½•å­˜åœ¨
    Path(ROOT_DIR + "/videotrans").mkdir(parents=True, exist_ok=True)
    ...
```

**ä¿®æ”¹ä½ç½® 2**ï¼ˆç¬¬ 320 è¡Œï¼‰ï¼š
```python
# ç¡®ä¿ videotrans ç›®å½•å­˜åœ¨
Path(ROOT_DIR + "/videotrans").mkdir(parents=True, exist_ok=True)
...
```

---

## ğŸ”§ é—®é¢˜ 3ï¼šFileNotFoundError - language/en.json

### é”™è¯¯ä¿¡æ¯
```
FileNotFoundError: [Errno 2] No such file or directory: 
'F:\\æ™ºèƒ½ä½“å®šåˆ¶\\20250904translateVideo\\pyvideotrans\\dist\\BDvideoTrans\\videotrans\\language\\en.json'
```

### åŸå› 
ç¨‹åºå°è¯•ä» `ROOT_DIR/videotrans/language/` è¯»å–è¯­è¨€æ–‡ä»¶ï¼Œä½†æ‰“åŒ…åçš„æ•°æ®æ–‡ä»¶åœ¨ `_internal/videotrans/language/`

### ä¿®å¤æ–¹æ¡ˆ
**æ–‡ä»¶**ï¼š`videotrans/configure/_config_loader.py`

**1. æ·»åŠ  `DATA_DIR` å˜é‡**ï¼ˆç¬¬ 15-50 è¡Œï¼‰ï¼š
```python
def _get_data_path():
    if IS_FROZEN:
        if hasattr(sys, '_MEIPASS'):
            return Path(sys._MEIPASS).as_posix()
        else:
            return Path(sys.executable).parent.as_posix()
    else:
        return Path(__file__).parent.parent.parent.as_posix()

DATA_DIR = _get_data_path()
_data_path = Path(DATA_DIR)
```

**2. ä¿®æ”¹è¯­è¨€æ–‡ä»¶è¯»å–**ï¼ˆç¬¬ 367-372 è¡Œï¼‰ï¼š
```python
_lang_path = _data_path / f'videotrans/language/{defaulelang}.json'
```

**3. ä¿®æ”¹å…¶ä»–æ•°æ®æ–‡ä»¶è¯»å–**ï¼ˆç¬¬ 653-656 è¡Œï¼‰ï¼š
```python
if Path(DATA_DIR + f'/videotrans/{_gemini_recogn_txt}').exists():
    params['gemini_srtprompt'] = Path(DATA_DIR + f'/videotrans/{_gemini_recogn_txt}').read_text(encoding='utf-8')
```

---

## ğŸ”§ é—®é¢˜ 4ï¼šFileNotFoundError - style.qssï¼ˆLoading å¡ä½ï¼‰

### é”™è¯¯ä¿¡æ¯
```
FileNotFoundError: [Errno 2] No such file or directory: 
'F:/æ™ºèƒ½ä½“å®šåˆ¶/20250904translateVideo/pyvideotrans/dist/BDvideoTrans/videotrans/styles/style.qss'
```

### åŸå› 
ç¨‹åºåœ¨å¤šä¸ªåœ°æ–¹ä½¿ç”¨ `ROOT_DIR` è¯»å–æ ·å¼æ–‡ä»¶ï¼Œä½†æ ·å¼æ–‡ä»¶åœ¨ `_internal/videotrans/styles/`

### ä¿®å¤æ–¹æ¡ˆ

**æ–‡ä»¶ 1**ï¼š`sp.py`
- ç¬¬ 43-45 è¡Œï¼šLogo å›¾ç‰‡è·¯å¾„
- ç¬¬ 106 è¡Œï¼šæ ·å¼è¡¨æ–‡ä»¶è·¯å¾„
- ç¬¬ 150 è¡Œï¼šå›¾æ ‡æ–‡ä»¶è·¯å¾„

```python
# ä¿®æ”¹å‰
logo_path = f"{config.ROOT_DIR}/videotrans/styles/logo_new.jpeg"

# ä¿®æ”¹å
logo_path = f"{config.DATA_DIR}/videotrans/styles/logo_new.jpeg"
```

**æ–‡ä»¶ 2**ï¼š`videotrans/mainwin/_main_win.py`
- ç¬¬ 285-287 è¡Œï¼šä¸»é¢˜æ ·å¼æ–‡ä»¶è·¯å¾„

```python
# ä¿®æ”¹å‰
css_path = f"{config.ROOT_DIR}/videotrans/styles/style.qss"

# ä¿®æ”¹å
css_path = f"{config.DATA_DIR}/videotrans/styles/style.qss"
```

**æ–‡ä»¶ 3**ï¼š`videotrans/ui/html_main.py`
- ç¬¬ 89 è¡Œï¼šWebUI æ–‡ä»¶è·¯å¾„

```python
# ä¿®æ”¹å‰
html_path = os.path.join(config.ROOT_DIR, "videotrans", "webui", "index.html")

# ä¿®æ”¹å
html_path = os.path.join(config.DATA_DIR, "videotrans", "webui", "index.html")
```

**æ–‡ä»¶ 4**ï¼š`videotrans/util/help_misc.py`
- ç¬¬ 190-215 è¡Œï¼šæç¤ºè¯æ–‡ä»¶è·¯å¾„å¤„ç†

```python
# é»˜è®¤æƒ…å†µï¼šä»æ•°æ®ç›®å½•è¯»å–ï¼ˆåªè¯»ï¼‰
return f'{config.DATA_DIR}/videotrans/{prompt_name}'
```

---

## ğŸ“Š æ ¸å¿ƒæ¦‚å¿µï¼šROOT_DIR vs DATA_DIR

### è·¯å¾„å˜é‡è¯´æ˜

| å˜é‡ | ç”¨é€” | æ‰“åŒ…åçš„å€¼ | ç¤ºä¾‹ |
|------|------|-----------|------|
| `ROOT_DIR` | å¯å†™æ–‡ä»¶ï¼ˆé…ç½®ã€æ—¥å¿—ã€ç”¨æˆ·æ•°æ®ï¼‰ | `sys.executable` çš„çˆ¶ç›®å½• | `F:/dist/BDvideoTrans/` |
| `DATA_DIR` | åªè¯»èµ„æºï¼ˆæ ·å¼ã€è¯­è¨€ã€webuiã€æ¨¡æ¿ï¼‰ | `sys._MEIPASS` | `F:/dist/BDvideoTrans/_internal/` |

### æ–‡ä»¶åˆ†ç±»è§„åˆ™

**åªè¯»æ•°æ®æ–‡ä»¶**ï¼ˆä» `DATA_DIR` è¯»å–ï¼‰ï¼š
- âœ… æ ·å¼æ–‡ä»¶ï¼š`videotrans/styles/*.qss`, `*.ico`, `*.png`, `*.jpeg`
- âœ… è¯­è¨€æ–‡ä»¶ï¼š`videotrans/language/*.json`
- âœ… Web UI æ–‡ä»¶ï¼š`videotrans/webui/*.html`, `*.css`, `*.js`
- âœ… æç¤ºè¯æ¨¡æ¿ï¼š`videotrans/*.txt`ï¼ˆé»˜è®¤æ¨¡æ¿ï¼‰

**å¯å†™é…ç½®æ–‡ä»¶**ï¼ˆä» `ROOT_DIR` è¯»å–/å†™å…¥ï¼‰ï¼š
- âœ… é…ç½®æ–‡ä»¶ï¼š`videotrans/cfg.json`
- âœ… å‚æ•°æ–‡ä»¶ï¼š`videotrans/params.json`
- âœ… ç”¨æˆ·æç¤ºè¯ï¼š`videotrans/prompts/srt/*.txt`
- âœ… ç”¨æˆ·é…ç½®ï¼š`hearsight_config.json`
- âœ… æ—¥å¿—æ–‡ä»¶ï¼š`logs/*.log`

---

## ğŸ“ æ‰“åŒ…åçš„ç›®å½•ç»“æ„

```
dist\BDvideoTrans\
â”œâ”€â”€ BDvideoTrans.exe          # ä¸»ç¨‹åº
â”œâ”€â”€ _internal\                # PyInstaller å†…éƒ¨æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
â”‚   â””â”€â”€ videotrans\           # Python æ¨¡å—å’Œæ•°æ®æ–‡ä»¶
â”‚       â”œâ”€â”€ language\         # è¯­è¨€æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
â”‚       â”‚   â”œâ”€â”€ en.json
â”‚       â”‚   â”œâ”€â”€ zh.json
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”œâ”€â”€ styles\           # æ ·å¼æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
â”‚       â”‚   â”œâ”€â”€ style.qss
â”‚       â”‚   â”œâ”€â”€ style_light.qss
â”‚       â”‚   â”œâ”€â”€ icon.ico
â”‚       â”‚   â”œâ”€â”€ logo.png
â”‚       â”‚   â””â”€â”€ logo_new.jpeg
â”‚       â”œâ”€â”€ webui\            # Web UI æ–‡ä»¶ï¼ˆåªè¯»ï¼‰
â”‚       â”‚   â”œâ”€â”€ index.html
â”‚       â”‚   â”œâ”€â”€ styles.css
â”‚       â”‚   â””â”€â”€ app.js
â”‚       â””â”€â”€ *.txt             # æç¤ºè¯æ¨¡æ¿ï¼ˆåªè¯»ï¼‰
â”œâ”€â”€ videotrans\               # ç”¨æˆ·æ•°æ®ç›®å½•ï¼ˆå¯å†™ï¼‰
â”‚   â”œâ”€â”€ cfg.json              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ params.json           # å‚æ•°æ–‡ä»¶
â”‚   â””â”€â”€ prompts\              # ç”¨æˆ·è‡ªå®šä¹‰æç¤ºè¯
â”‚       â””â”€â”€ srt\
â”œâ”€â”€ logs\                     # æ—¥å¿—ç›®å½•
â”‚   â””â”€â”€ 20251005.log
â”œâ”€â”€ tmp\                      # ä¸´æ—¶ç›®å½•
â”œâ”€â”€ cache\                    # ç¼“å­˜ç›®å½•
â””â”€â”€ ...
```

---

## ğŸ¯ æŠ€æœ¯è¦ç‚¹æ€»ç»“

### 1. PyInstaller çš„é™åˆ¶

- **é™æ€åˆ†æé™åˆ¶**ï¼šåªèƒ½æ£€æµ‹é™æ€å¯¼å…¥è¯­å¥
- **åŠ¨æ€å¯¼å…¥é—®é¢˜**ï¼š`importlib.import_module()` æ— æ³•è¢«æ£€æµ‹
- **æ¨¡å—æ›¿æ¢é—®é¢˜**ï¼š`sys.modules[__name__] = custom_object` ä¼šå¯¼è‡´é—®é¢˜

### 2. æœ€ä½³å®è·µ

**å¯¼å…¥æ–¹å¼**ï¼š
- âœ… ä½¿ç”¨é™æ€å¯¼å…¥ï¼š`from module import *` æˆ– `import module`
- âŒ é¿å…åŠ¨æ€å¯¼å…¥ï¼š`importlib.import_module()`
- âŒ é¿å…æ¨¡å—æ›¿æ¢ï¼š`sys.modules[__name__] = custom_object`

**æ–‡ä»¶è·¯å¾„**ï¼š
- âœ… åŒºåˆ†å¯å†™ç›®å½•ï¼ˆ`ROOT_DIR`ï¼‰å’Œåªè¯»æ•°æ®ç›®å½•ï¼ˆ`DATA_DIR`ï¼‰
- âœ… ä½¿ç”¨ `sys._MEIPASS` è®¿é—®æ‰“åŒ…çš„æ•°æ®æ–‡ä»¶
- âœ… ç¡®ä¿ç›®å½•å­˜åœ¨ï¼š`Path().mkdir(parents=True, exist_ok=True)`

### 3. sys._MEIPASS çš„ä½œç”¨

- PyInstaller æ‰“åŒ…åï¼Œä¼šå°†ç¨‹åºè§£å‹åˆ°ä¸´æ—¶ç›®å½•
- `sys._MEIPASS` æŒ‡å‘è¿™ä¸ªä¸´æ—¶ç›®å½•
- æ‰€æœ‰æ‰“åŒ…çš„æ•°æ®æ–‡ä»¶éƒ½åœ¨è¿™ä¸ªç›®å½•ä¸‹
- ç¨‹åºé€€å‡ºåï¼Œä¸´æ—¶ç›®å½•ä¼šè¢«åˆ é™¤

---

## âœ… éªŒè¯ç»“æœ

### ç¨‹åºçŠ¶æ€
- âœ… æ‰“åŒ…æˆåŠŸ
- âœ… ç¨‹åºæˆåŠŸå¯åŠ¨
- âœ… Loading ç•Œé¢æ­£å¸¸æ˜¾ç¤ºå¹¶æ¶ˆå¤±
- âœ… ä¸»ç•Œé¢æ­£å¸¸åŠ è½½
- âœ… æ²¡æœ‰ä»»ä½•é”™è¯¯

### ç›®å½•ç»“æ„
- âœ… `dist\BDvideoTrans\videotrans\` - é…ç½®æ–‡ä»¶ç›®å½•å·²åˆ›å»º
- âœ… `dist\BDvideoTrans\_internal\videotrans\language\` - è¯­è¨€æ–‡ä»¶å·²æ‰“åŒ…
- âœ… `dist\BDvideoTrans\_internal\videotrans\styles\` - æ ·å¼æ–‡ä»¶å·²æ‰“åŒ…
- âœ… `dist\BDvideoTrans\_internal\videotrans\webui\` - WebUI æ–‡ä»¶å·²æ‰“åŒ…

### åŠŸèƒ½æµ‹è¯•
- âœ… æ ·å¼æ–‡ä»¶æ­£ç¡®åŠ è½½
- âœ… å›¾æ ‡æ­£ç¡®æ˜¾ç¤º
- âœ… è¯­è¨€æ–‡ä»¶æ­£ç¡®åŠ è½½
- âœ… ä¸»é¢˜åˆ‡æ¢æ­£å¸¸å·¥ä½œ
- âœ… HTML UI æ­£å¸¸åŠ è½½

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

1. âœ… `videotrans/configure/config.py` - ç§»é™¤æ‡’åŠ è½½ï¼Œä½¿ç”¨é™æ€å¯¼å…¥
2. âœ… `videotrans/configure/_config_loader.py` - æ·»åŠ  DATA_DIRï¼Œä¿®æ”¹æ–‡ä»¶è¯»å–è·¯å¾„
3. âœ… `sp.py` - ä¿®æ”¹æ ·å¼æ–‡ä»¶ã€å›¾æ ‡æ–‡ä»¶è·¯å¾„
4. âœ… `videotrans/mainwin/_main_win.py` - ä¿®æ”¹ä¸»é¢˜æ ·å¼æ–‡ä»¶è·¯å¾„
5. âœ… `videotrans/ui/html_main.py` - ä¿®æ”¹ WebUI æ–‡ä»¶è·¯å¾„
6. âœ… `videotrans/util/help_misc.py` - ä¿®æ”¹æç¤ºè¯æ–‡ä»¶è·¯å¾„å¤„ç†

---

## ğŸš€ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•ç¨‹åºåŠŸèƒ½**ï¼š
   - æµ‹è¯•è§†é¢‘ç¿»è¯‘åŠŸèƒ½
   - æµ‹è¯•ä¸»é¢˜åˆ‡æ¢
   - æµ‹è¯• HTML UI
   - æµ‹è¯•é…ç½®ä¿å­˜

2. **åˆ›å»ºå‘å¸ƒåŒ…**ï¼ˆå¯é€‰ï¼‰ï¼š
   ```bash
   python create_release.py
   ```

3. **åˆ†å‘ç¨‹åº**ï¼š
   - å°†æ•´ä¸ª `dist\BDvideoTrans\` æ–‡ä»¶å¤¹æ‰“åŒ…åˆ†å‘

---

**ä¿®æ”¹æ—¥æœŸ**ï¼š2025-10-05  
**ä¿®æ”¹äºº**ï¼šAI Assistant  
**çŠ¶æ€**ï¼šâœ… å·²éªŒè¯é€šè¿‡ï¼ˆæ‰€æœ‰é—®é¢˜å·²å®Œå…¨è§£å†³ï¼‰

