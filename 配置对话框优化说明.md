# 配置对话框优化说明

更新日期: 2025-10-11

## 🎨 优化内容

### 1. 添加滚动功能 ✅

**问题**: 配置对话框内容过多时无法下滑查看所有配置项

**解决方案**:
- 添加 `QScrollArea` 滚动区域
- 标题栏固定在顶部（不滚动）
- 按钮区域固定在底部（不滚动）
- 中间配置内容可以滚动

**技术实现**:
```python
# 主布局结构
QDialog
├── 标题栏 (固定)
├── QScrollArea (可滚动)
│   └── 所有配置组
│       ├── LLM API 配置
│       ├── 段落合并参数
│       ├── 提示词配置 ⭐ NEW
│       └── 向量化服务配置
└── 按钮区域 (固定)
```

**UI改进**:
- 美化的滚动条样式
- 12px宽度，圆角设计
- 悬停时高亮显示
- 与整体UI风格统一

### 2. 添加自定义提示词配置 ✅

**问题**: 用户无法自定义LLM生成摘要的提示词

**新增功能**:

#### 📝 提示词配置组

在"段落合并参数"和"向量化服务配置"之间添加新配置组：

```
📝 提示词配置
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 段落摘要提示词:
   [多行文本输入框]

📋 整体摘要提示词:
   [多行文本输入框]
```

#### 段落摘要提示词

**用途**: 为每个视频段落生成简短摘要

**可用变量**:
- `{text}` - 段落的完整文本内容
- `{duration}` - 段落时长（秒）

**默认提示词示例**:
```
请用一句话总结以下视频片段的内容：

{text}

要求：
1. 简洁明了，不超过30字
2. 提取核心观点
3. 使用客观的叙述语气
```

**高级示例**:
```
作为一名专业的视频分析师，请分析以下内容（时长{duration}秒）：

{text}

请提供：
1. 核心主题（5-10字）
2. 关键信息点（1-2个）
3. 情感基调（如有）
```

#### 整体摘要提示词

**用途**: 基于所有段落摘要生成视频的整体总结

**可用变量**:
- `{paragraphs}` - 所有段落摘要的列表（每个段落的摘要）
- `{total_duration}` - 视频总时长（秒）

**默认提示词示例**:
```
基于以下视频片段摘要，生成一个完整的视频总结：

{paragraphs}

视频总时长：{total_duration}秒

要求：
1. 概括视频的主要主题和目的
2. 突出关键观点
3. 保持简洁（100-200字）
```

**高级示例**:
```
作为内容策划师，请基于以下片段摘要，创建一个吸引人的视频简介：

片段摘要：
{paragraphs}

视频时长：{total_duration}秒

请包含：
1. 引人入胜的开头（1句话）
2. 主要内容概述（3-5个要点）
3. 目标受众和价值（1句话）
4. 推荐关键词（3-5个）
```

## 📐 界面布局

### 配置对话框结构

```
┌─────────────────────────────────────────────────┐
│ ⚙️ 智能摘要配置中心 (固定)                        │
├─────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────┐ ▲ │
│ │ 🤖 LLM API 配置                           │ │ │
│ │   [API Key, Base URL, Model等]           │ │ │
│ │                                           │ │ │
│ │ 📐 段落合并参数                            │ │ │
│ │   [最大时间间隔, 最大段落时长, 最大字符数]  │ │ │
│ │                                           │ ║ │ 可
│ │ 📝 提示词配置 ⭐ NEW                       │ ║ │ 滚
│ │   📄 段落摘要提示词:                       │ ║ │ 动
│ │   ┌────────────────────────────────┐     │ ║ │ 区
│ │   │ 多行文本输入                      │     │ ║ │ 域
│ │   └────────────────────────────────┘     │ ║ │
│ │   📋 整体摘要提示词:                       │ ║ │
│ │   ┌────────────────────────────────┐     │ ║ │
│ │   │ 多行文本输入                      │     │ ║ │
│ │   └────────────────────────────────┘     │ │ │
│ │                                           │ │ │
│ │ 🗄️ 向量化服务配置                         │ │ │
│ │   [ChromaDB / 火山引擎]                  │ ▼ │
│ └──────────────────────────────────────────┘   │
├─────────────────────────────────────────────────┤
│ [🔌 测试连接]  [💾 保存配置]  [❌ 取消] (固定)   │
└─────────────────────────────────────────────────┘
```

## 🔧 技术细节

### 滚动区域实现

**样式定义**:
```python
scroll_area.setStyleSheet("""
    QScrollArea {
        background-color: transparent;
        border: none;
    }
    QScrollBar:vertical {
        border: none;
        background: #f0f4f8;
        width: 12px;
        margin: 0;
    }
    QScrollBar::handle:vertical {
        background: #cbd5e0;
        border-radius: 6px;
        min-height: 30px;
    }
    QScrollBar::handle:vertical:hover {
        background: #a0aec0;
    }
""")
```

**关键设置**:
- `setWidgetResizable(True)` - 自动调整内容大小
- `setFrameShape(QScrollArea.NoFrame)` - 无边框
- 内容区域使用 `QWidget` 包装

### 提示词输入组件

**组件类型**: `QTextEdit`

**特性**:
- 多行文本输入
- 最大高度限制（100px）
- 支持换行和长文本
- 占位符提示使用方法

**数据绑定**:
```python
# 保存
config['prompts'] = {
    'paragraph': self.para_prompt_input.toPlainText().strip(),
    'overall': self.overall_prompt_input.toPlainText().strip()
}

# 加载
self.para_prompt_input.setPlainText(config['prompts']['paragraph'])
self.overall_prompt_input.setPlainText(config['prompts']['overall'])
```

## 💡 使用场景

### 场景1: 针对教育视频优化提示词

**段落摘要**:
```
请提取这段教学内容的知识点：

{text}

输出格式：
知识点：[核心概念]
难度：[初级/中级/高级]
```

**整体摘要**:
```
这是一个教育视频，包含以下知识点：

{paragraphs}

请生成：
1. 课程标题（简洁有力）
2. 学习目标（3-5个）
3. 适合人群
4. 预计学习时间：{total_duration}秒
```

### 场景2: 新闻视频摘要

**段落摘要**:
```
作为新闻编辑，提取这段新闻的核心信息：

{text}

格式：[事件] - [地点] - [关键人物/机构]
```

**整体摘要**:
```
新闻报道摘要：

{paragraphs}

请提供：
1. 新闻标题（10-15字）
2. 导语（30字内）
3. 关键事实（3-5点）
4. 新闻类别（政治/经济/社会/科技等）
```

### 场景3: 产品评测视频

**段落摘要**:
```
提取产品评测要点：

{text}

关注：功能特性、优缺点、使用体验
```

**整体摘要**:
```
产品评测总结：

{paragraphs}

请包括：
1. 产品名称和定位
2. 核心功能（3-5个）
3. 优势与不足
4. 购买建议
5. 适合人群
```

## 📊 配置示例

### 完整配置JSON

```json
{
  "llm": {
    "api_key": "sk-xxxxx",
    "base_url": "https://api.openai.com/v1",
    "model": "gpt-3.5-turbo",
    "temperature": 0.3,
    "timeout": 120
  },
  "merge": {
    "max_gap": 2.0,
    "max_duration": 30.0,
    "max_chars": 200
  },
  "prompts": {
    "paragraph": "请用一句话总结以下内容：\n\n{text}",
    "overall": "基于以下段落摘要，生成视频总结：\n\n{paragraphs}\n\n视频时长：{total_duration}秒"
  },
  "vector": {
    "type": "chromadb"
  }
}
```

## 🎯 最佳实践

### 提示词设计原则

1. **明确任务**: 清楚说明需要LLM做什么
2. **提供上下文**: 给出足够的背景信息
3. **指定格式**: 明确输出格式要求
4. **设置约束**: 如字数限制、风格要求
5. **使用变量**: 充分利用 `{text}`、`{duration}` 等变量

### 调试技巧

1. **逐步细化**: 从简单提示词开始，逐步添加要求
2. **对比测试**: 尝试不同的提示词，比较效果
3. **查看日志**: 检查实际生成的摘要质量
4. **迭代优化**: 根据结果持续改进提示词

### 常见问题

**Q: 提示词为空会怎样？**
A: 系统会使用内置的默认提示词

**Q: 提示词太长会影响性能吗？**
A: 会。建议段落提示词<200字，整体提示词<300字

**Q: 变量格式错误会报错吗？**
A: 不会报错，但变量不会被替换

**Q: 可以使用其他变量吗？**
A: 目前只支持文档中列出的变量

## 📝 更新日志

### v1.1 (2025-10-11)
- ✅ 添加滚动功能
- ✅ 固定标题栏和按钮区域
- ✅ 美化滚动条样式
- ✅ 添加提示词配置组
- ✅ 支持段落和整体摘要提示词自定义
- ✅ 提示词配置持久化

## 🔄 兼容性

- ✅ 向后兼容：旧配置文件会使用默认提示词
- ✅ 配置验证：空提示词自动使用默认值
- ✅ 数据迁移：无需手动迁移配置

## 📚 相关文档

- [向量化服务配置界面使用说明](./向量化服务配置界面使用说明.md)
- [功能更新总结](./功能更新总结.md)
- [问题修复说明](./问题修复说明.md)

---

**优化版本**: v1.1
**更新日期**: 2025-10-11
**改进点**: 添加滚动 + 自定义提示词
