# 向量化服务配置界面使用说明

## 打开配置界面的方法

### 方法1: HTML UI界面（推荐）

1. 启动程序（会自动显示HTML UI界面）
2. 在 **"输入与输出"** 部分找到 **"智能摘要"** 选项
3. 点击智能摘要右侧的 **⚙️ 配置按钮**
4. 配置对话框会自动弹出

**界面位置**:
```
输入与输出
━━━━━━━━━━━━━━━━━━━━━
📁 选择视频  [按钮]
💾 选择保存目录  [按钮]
🌐 代理  [输入框]
☑️ 智能摘要  [⚙️]  ← 点击这里
☑️ 视频预处理
```

### 方法2: Qt原生UI界面（侧边栏）

1. 启动程序
2. 查看界面左侧的**垂直侧边栏**
3. 找到 **⚙️ 配置图标**按钮
4. 点击即可打开配置对话框

**侧边栏按钮**:
```
┌──────┐
│  🎬  │ ← HearSight查看器
│  ⚙️  │ ← 智能摘要配置（点击这里）
│  📚  │ ← 摘要管理器
│  ⚙️  │ ← 系统设置
│  ℹ️  │ ← 关于
└──────┘
```

### 方法3: 菜单栏（如果可用）

在某些版本中，配置按钮也可能出现在顶部工具栏中。

## 配置界面内容

### 1. LLM API 配置

用于生成视频摘要的大语言模型配置：

```
🤖 LLM API 配置
━━━━━━━━━━━━━━━━━━━━━
🔑 API Key *: [输入框]
🌐 Base URL *: https://api.openai.com/v1
🤖 Model *: [下拉选择]
🌡️ Temperature: 0.3
⏱️ 超时时间: 120 秒
```

**必填项**:
- API Key: 您的大语言模型API密钥
- Base URL: API服务地址
- Model: 使用的模型名称

**支持的模型**:
- OpenAI (GPT-3.5, GPT-4, GPT-4o)
- DeepSeek
- Gemini
- Claude
- 其他OpenAI兼容API

### 2. 段落合并参数

控制视频字幕如何合并成段落：

```
📐 段落合并参数
━━━━━━━━━━━━━━━━━━━━━
⏳ 最大时间间隔: 2.0 秒
⏱️ 最大段落时长: 30.0 秒
📝 最大字符数: 200
```

**参数说明**:
- **最大时间间隔**: 相邻字幕间隔超过此值会分段
- **最大段落时长**: 单个段落最长时间
- **最大字符数**: 单个段落最多字符数

### 3. 向量化服务配置 ⭐

选择和配置向量存储后端：

```
🗄️ 向量化服务配置
━━━━━━━━━━━━━━━━━━━━━
📦 向量存储类型: [ChromaDB (本地) ▼]
                  [火山引擎向量化服务 ▼]
```

#### 选项1: ChromaDB (本地)

- 完全本地化存储
- 无需额外配置
- 免费使用
- 适合个人使用

#### 选项2: 火山引擎向量化服务 ⭐

选择此选项后会显示额外配置项：

```
🔑 API Key: [输入框]
🌐 Base URL: https://ark.cn-beijing.volces.com/api/v3
📚 Collection名称: video_summaries
🤖 Embedding模型: [输入框]
```

**火山引擎配置**:
- **API Key**: `2cad3d85-a6a5-433e-9ac5-41598e1aae83` （示例）
- **Base URL**: 默认值通常无需修改
- **Collection名称**: 向量集合名称，可自定义
- **Embedding模型**: endpoint ID，如 `ep-20241217191853-w54rf`

## 操作按钮

### 🔌 测试连接

点击此按钮会：
1. 测试LLM API连接
2. 如果选择了火山引擎，也会测试向量化服务
3. 显示测试结果

**成功示例**:
```
✅ LLM连接正常
模型响应：你好！我是AI助手...

✅ 火山引擎向量化服务连接正常
```

**失败示例**:
```
❌ 连接测试失败
错误: API Key无效或已过期
```

### 💾 保存配置

保存所有配置到本地文件 `hearsight_config.json`

**保存成功**:
```
✅ 配置已保存
```

### ❌ 取消

关闭对话框，不保存任何修改。

## 完整配置示例

### 示例1: 使用OpenAI + ChromaDB

```json
{
  "llm": {
    "api_key": "sk-xxxxxxxxxxxx",
    "base_url": "https://api.openai.com/v1",
    "model": "gpt-3.5-turbo",
    "temperature": 0.3,
    "timeout": 120
  },
  "merge": {
    "max_gap": 2.0,
    "max_duration": 30.0,
    "max_chars": 200
  },
  "vector": {
    "type": "chromadb"
  }
}
```

### 示例2: 使用DeepSeek + 火山引擎

```json
{
  "llm": {
    "api_key": "sk-xxxxxxxxxxxx",
    "base_url": "https://api.deepseek.com/v1",
    "model": "deepseek-chat",
    "temperature": 0.3,
    "timeout": 120
  },
  "merge": {
    "max_gap": 2.0,
    "max_duration": 30.0,
    "max_chars": 200
  },
  "vector": {
    "type": "volcengine",
    "volcengine": {
      "api_key": "2cad3d85-a6a5-433e-9ac5-41598e1aae83",
      "base_url": "https://ark.cn-beijing.volces.com/api/v3",
      "collection_name": "video_summaries",
      "embedding_model": "ep-20241217191853-w54rf"
    }
  }
}
```

## 使用流程

### 首次配置

1. **打开配置界面**
   - HTML UI: 点击智能摘要旁的 ⚙️
   - Qt UI: 点击侧边栏的配置图标

2. **配置LLM**
   - 填写API Key
   - 选择或输入模型名称
   - 调整Temperature（可选）

3. **选择向量存储**
   - 个人使用: 选择 "ChromaDB (本地)"
   - 企业/高级: 选择 "火山引擎向量化服务"

4. **测试连接**
   - 点击 "🔌 测试连接" 按钮
   - 确认所有服务正常

5. **保存配置**
   - 点击 "💾 保存配置"
   - 等待成功提示

### 修改配置

1. 打开配置界面
2. 修改需要更改的参数
3. 点击 "测试连接" 验证
4. 点击 "保存配置"

### 切换向量存储后端

1. 打开配置界面
2. 在 "向量存储类型" 下拉菜单选择新后端
3. 如果选择火山引擎，填写相关参数
4. 测试并保存

**注意**: 切换后端后，需要重新生成向量数据。

## 配置文件位置

配置保存在项目根目录：
```
pyvideotrans/
└── hearsight_config.json
```

可以手动编辑此文件，但建议使用UI界面配置。

## 常见问题

### Q1: 点击配置按钮没反应？

**A**: 检查以下几点：
1. 确认使用的是HTML UI还是Qt UI
2. 检查控制台是否有错误信息
3. 重启程序再试

### Q2: 测试连接失败？

**A**: 可能原因：
1. API Key错误或过期
2. Base URL无法访问（网络问题）
3. 模型名称不正确
4. 防火墙阻止连接

**解决方法**:
1. 验证API Key有效性
2. 检查网络连接和代理设置
3. 确认模型名称拼写正确

### Q3: 火山引擎向量化服务配置失败？

**A**: 检查：
1. Embedding模型endpoint ID是否正确
2. API Key是否有embedding权限
3. Base URL是否正确

### Q4: 配置保存后不生效？

**A**:
1. 确认看到 "配置已保存" 提示
2. 检查 `hearsight_config.json` 文件内容
3. 重启程序加载新配置

### Q5: 如何获取火山引擎的endpoint ID？

**A**:
1. 登录火山引擎控制台
2. 进入 "火山方舟" → "推理接入"
3. 创建或查看Embedding推理接入点
4. 复制endpoint ID（格式：ep-xxxxxx）

## 安全建议

1. **不要分享API Key**: API密钥是敏感信息
2. **定期更换密钥**: 增强安全性
3. **备份配置**: 定期备份 `hearsight_config.json`
4. **版本控制**: 如果使用Git，将 `hearsight_config.json` 添加到 `.gitignore`

## 高级技巧

### 技巧1: 使用环境变量

可以通过环境变量设置API Key：
```bash
export OPENAI_API_KEY="sk-xxxxx"
export VOLCENGINE_API_KEY="xxxxx"
```

### 技巧2: 多环境配置

为不同环境准备不同配置文件：
- `hearsight_config.dev.json` (开发)
- `hearsight_config.prod.json` (生产)
- `hearsight_config.test.json` (测试)

### 技巧3: 批量测试

编写脚本批量测试不同配置：
```python
from videotrans.hearsight.volcengine_vector import VolcengineVectorClient

configs = [...]
for config in configs:
    client = VolcengineVectorClient(**config)
    if client.test_connection():
        print(f"✅ {config['embedding_model']}")
```

## 更新日志

### v1.0 (2025-10-11)
- ✅ 添加HTML UI配置入口
- ✅ 添加Qt UI侧边栏配置入口
- ✅ 支持火山引擎向量化服务配置
- ✅ 添加连接测试功能
- ✅ 支持配置持久化

## 相关文档

- [火山引擎向量化服务集成说明](./火山引擎向量化服务集成说明.md)
- [火山引擎向量化快速开始](./火山引擎向量化快速开始.md)
- [视频预处理功能说明](./视频预处理功能说明.md)

## 反馈与支持

遇到问题？
1. 查看日志文件获取详细错误
2. 在GitHub仓库提交Issue
3. 附上配置信息（隐藏API Key）
