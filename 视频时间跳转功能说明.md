# 视频时间跳转功能说明

## 功能概述

为HearSight智能摘要功能添加了视频播放和时间跳转功能，用户可以通过点击段落摘要直接播放视频并跳转到对应的时间点。

## 功能特性

### 1. 摘要管理器（Summary Manager）

**位置**: 主界面 → 点击"📚"按钮

**功能**:
- 查看所有已生成的视频摘要
- 点击段落时间链接，自动播放视频并跳转到对应时间点
- 支持语义搜索和摘要导出

**使用方法**:
1. 在主界面点击"📚 摘要管理"按钮
2. 从左侧列表选择一个视频
3. 切换到"📝 段落详情"标签页
4. 点击任意段落的时间链接（如 "▶️ 00:00 - 01:30"）
5. 视频播放器会自动打开并跳转到该时间点

**时间链接样式**:
```
📍 段落 1
▶️ 00:00 - 01:30  ← 可点击的时间链接
```

### 2. HearSight查看器（HearSight Viewer）

**位置**: 主界面 → 点击"🎯 HearSight"按钮 → 选择SRT文件

**功能**:
- 实时处理SRT字幕文件生成摘要
- 双击段落列表项，播放视频并跳转到对应时间点
- 支持导出Markdown格式摘要

**使用方法**:
1. 在主界面点击"🎯 HearSight"按钮
2. 选择一个SRT字幕文件
3. 等待处理完成，查看摘要结果
4. 在左侧段落列表中**双击**任意段落
5. 视频播放器会自动打开并跳转到该时间点

**注意**: 
- 视频文件需要与SRT文件在同一目录
- 视频文件名需要与SRT文件名相同（扩展名不同）
- 例如: `video.srt` 对应 `video.mp4`

## 支持的播放器

### Windows平台

**优先级顺序**:
1. **VLC Media Player** (推荐)
   - 安装路径: `C:\Program Files\VideoLAN\VLC\vlc.exe`
   - 支持精确时间跳转
   - 免费开源

2. **PotPlayer**
   - 安装路径: `C:\Program Files\DAUM\PotPlayer\PotPlayerMini64.exe`
   - 支持时间跳转
   - 功能强大

3. **系统默认播放器**
   - 如果以上播放器都未安装，使用系统默认播放器
   - ⚠️ 不支持时间跳转，从头开始播放

### macOS平台

**优先级顺序**:
1. **IINA** (推荐)
   - 现代化的macOS视频播放器
   - 支持时间跳转
   - 免费开源

2. **VLC Media Player**
   - 跨平台播放器
   - 支持时间跳转
   - 免费开源

3. **系统默认播放器**
   - 如果以上播放器都未安装，使用系统默认播放器
   - ⚠️ 不支持时间跳转

### Linux平台

**优先级顺序**:
1. **VLC Media Player** (推荐)
   - 命令: `vlc`
   - 支持时间跳转
   - 免费开源

2. **MPV**
   - 命令: `mpv`
   - 轻量级播放器
   - 支持时间跳转

3. **系统默认播放器**
   - 如果以上播放器都未安装，使用系统默认播放器
   - ⚠️ 不支持时间跳转

## 安装推荐播放器

### Windows

**VLC Media Player** (推荐):
1. 访问: https://www.videolan.org/vlc/
2. 下载Windows版本
3. 安装到默认路径: `C:\Program Files\VideoLAN\VLC\`

**PotPlayer**:
1. 访问: https://potplayer.daum.net/
2. 下载64位版本
3. 安装到默认路径

### macOS

**IINA** (推荐):
```bash
brew install --cask iina
```
或访问: https://iina.io/

**VLC**:
```bash
brew install --cask vlc
```

### Linux

**VLC**:
```bash
# Ubuntu/Debian
sudo apt install vlc

# Fedora
sudo dnf install vlc

# Arch Linux
sudo pacman -S vlc
```

**MPV**:
```bash
# Ubuntu/Debian
sudo apt install mpv

# Fedora
sudo dnf install mpv

# Arch Linux
sudo pacman -S mpv
```

## 技术实现

### 1. 摘要管理器实现

**文件**: `videotrans/ui/summary_manager.py`

**关键功能**:
- 在段落HTML中添加可点击的时间链接
- 使用自定义URL协议 `playvideo://时间戳`
- 监听`anchorClicked`信号处理链接点击
- 根据操作系统调用相应的播放器

**代码示例**:
```python
# 创建可点击的时间链接
time_link = f"playvideo://{start_time}"

# HTML中的链接
<a href="{time_link}" style="...">
    ▶️ {start_str} - {end_str}
</a>

# 处理链接点击
self.paragraph_tab.anchorClicked.connect(self.on_time_link_clicked)
```

### 2. HearSight查看器实现

**文件**: `videotrans/ui/hearsight_viewer.py`

**关键功能**:
- 双击段落列表项触发播放
- 自动查找对应的视频文件
- 调用播放器并传递时间参数

**代码示例**:
```python
# 双击事件
self.paragraph_list.itemDoubleClicked.connect(self.on_paragraph_double_clicked)

# 播放视频
def on_paragraph_double_clicked(self, item):
    para = item.data(Qt.UserRole)
    start_time = para.get("start_time", 0.0)
    self.play_video_at_time(self.video_path, start_time)
```

### 3. 视频文件自动查找

**文件**: `videotrans/mainwin/_main_win.py`

**逻辑**:
1. 用户选择SRT文件
2. 提取SRT文件的目录和基础名称
3. 遍历常见视频扩展名（.mp4, .mkv, .avi等）
4. 查找同名的视频文件
5. 将视频路径传递给查看器

**支持的视频格式**:
- MP4 (.mp4)
- MKV (.mkv)
- AVI (.avi)
- MOV (.mov)
- FLV (.flv)
- WMV (.wmv)
- WebM (.webm)

## 使用场景

### 场景1: 快速定位视频内容

**问题**: 想快速找到视频中讨论某个主题的部分

**解决方案**:
1. 打开摘要管理器
2. 浏览段落摘要
3. 找到感兴趣的段落
4. 点击时间链接直接跳转观看

### 场景2: 学习笔记回顾

**问题**: 看过的视频想回顾某个知识点

**解决方案**:
1. 在摘要管理器中搜索关键词
2. 查看搜索结果中的段落
3. 点击时间链接重新观看该部分

### 场景3: 视频内容验证

**问题**: 想验证AI生成的摘要是否准确

**解决方案**:
1. 查看段落摘要
2. 双击段落或点击时间链接
3. 观看原视频对应部分
4. 对比摘要和实际内容

## 常见问题

### Q1: 点击时间链接没有反应？

**可能原因**:
1. 未安装支持的播放器
2. 视频文件不存在或已移动
3. 视频文件路径包含特殊字符

**解决方法**:
1. 安装VLC播放器（推荐）
2. 确认视频文件存在
3. 检查视频文件路径

### Q2: 播放器打开了但从头开始播放？

**原因**: 使用的是系统默认播放器，不支持时间跳转

**解决方法**: 安装VLC、PotPlayer（Windows）、IINA（macOS）或MPV（Linux）

### Q3: 双击段落没有反应？

**可能原因**:
1. 视频路径未设置
2. SRT文件和视频文件名不匹配

**解决方法**:
1. 确保视频文件与SRT文件在同一目录
2. 确保文件名相同（扩展名可以不同）
3. 例如: `video.srt` 和 `video.mp4`

### Q4: 支持哪些视频格式？

**支持的格式**:
- MP4, MKV, AVI, MOV, FLV, WMV, WebM
- 只要播放器支持的格式都可以

### Q5: 可以自定义播放器吗？

**当前版本**: 自动检测常用播放器

**未来计划**: 将添加配置选项，允许用户指定播放器路径

## 更新日志

### v1.0.0 (2025-01-03)

**新增功能**:
- ✅ 摘要管理器中的可点击时间链接
- ✅ HearSight查看器中的双击播放功能
- ✅ 自动查找对应的视频文件
- ✅ 跨平台播放器支持（Windows/macOS/Linux）
- ✅ 智能播放器检测和回退机制

**修复问题**:
- ✅ 修复ChromaDB多条件查询错误
- ✅ 移除QSS中不支持的box-shadow属性

**技术改进**:
- ✅ 添加视频路径管理
- ✅ 优化播放器调用逻辑
- ✅ 改进错误处理和用户提示

## 反馈与建议

如果您在使用过程中遇到问题或有改进建议，欢迎反馈！

